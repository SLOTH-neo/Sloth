local services = setmetatable({}, {__index = function(_, k) return game:GetService(k) end})
local ts = services.TweenService
local plr = services.Players.LocalPlayer
local run = services.RunService
local uis = services.UserInputService

-- [[ ğŸŒ¸ æ«»èŠ±ç»ç’ƒé…è‰²æ–¹æ¡ˆ ]]
local C = {
    Accent = Color3.fromRGB(255, 120, 180), -- è²“è²“ç²‰
    MainBG = Color3.fromRGB(15, 15, 18),   -- æ·±é‚ƒç»ç’ƒ
    BtnBG  = Color3.fromRGB(30, 30, 35),   -- å…ƒä»¶åº•è‰²
    Text   = Color3.fromRGB(220, 220, 225),
    Stroke = Color3.fromRGB(255, 255, 255),
}

local function Tween(obj, info, prop)
    local t = ts:Create(obj, TweenInfo.new(unpack(info)), prop)
    t:Play()
    return t
end

-- å»ºç«‹ UI åŸºç¤
local main = Instance.new("ScreenGui", services.CoreGui)
main.Name = "NekoFly_Ultimate_2026"
main.ResetOnSpawn = false

local Frame = Instance.new("Frame", main)
Frame.Size = UDim2.new(0, 220, 0, 110) -- ç¨å¾®åŠ é«˜æ”¾ç©¿ç‰†æŒ‰éˆ•
Frame.Position = UDim2.new(0.1, 0, 0.4, 0)
Frame.BackgroundColor3 = C.MainBG
Frame.BackgroundTransparency = 0.1
Frame.BorderSizePixel = 0
Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 12)

local GlassStroke = Instance.new("UIStroke", Frame)
GlassStroke.Thickness = 1; GlassStroke.Color = C.Stroke; GlassStroke.Transparency = 0.85

-- æŒ‰éˆ•å»ºç«‹å‡½æ•¸
local function CreateBtn(text, pos, size)
    local b = Instance.new("TextButton", Frame)
    b.Text = text; b.Position = pos; b.Size = size
    b.BackgroundColor3 = C.BtnBG; b.TextColor3 = C.Text
    b.Font = Enum.Font.GothamMedium; b.TextSize = 11; b.BorderSizePixel = 0
    Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)
    b.MouseButton1Down:Connect(function() Tween(b, {0.1}, {Size = UDim2.new(size.X.Scale, size.X.Offset-3, size.Y.Scale, size.Y.Offset-3)}) end)
    b.MouseButton1Up:Connect(function() Tween(b, {0.2, Enum.EasingStyle.Back}, {Size = size}) end)
    return b
end

-- å»ºç«‹å…ƒä»¶
local up = CreateBtn("UP ğŸ¾", UDim2.new(0.05, 0, 0.1, 0), UDim2.new(0, 44, 0, 28))
local down = CreateBtn("DOWN ğŸ¾", UDim2.new(0.05, 0, 0.4, 0), UDim2.new(0, 44, 0, 28))
local plus = CreateBtn("+", UDim2.new(0.3, 0, 0.1, 0), UDim2.new(0, 35, 0, 28))
local mine = CreateBtn("-", UDim2.new(0.3, 0, 0.4, 0), UDim2.new(0, 35, 0, 28))
local onof = CreateBtn("è²“é£›è¡Œ", UDim2.new(0.7, 0, 0.4, 0), UDim2.new(0, 55, 0, 28))
local noclipBtn = CreateBtn("ç©¿ç‰†: é—œ", UDim2.new(0.05, 0, 0.72, 0), UDim2.new(0, 200, 0, 25))

local title = Instance.new("TextLabel", Frame)
title.Text = "è²“è²“é£›è¡Œ"; title.Size = UDim2.new(0, 80, 0, 28); title.Position = UDim2.new(0.52, 0, 0.1, 0)
title.TextColor3 = C.Accent; title.Font = Enum.Font.GothamBold; title.TextSize = 13; title.BackgroundTransparency = 1

local speed = Instance.new("TextLabel", Frame)
speed.Text = "1"; speed.Size = UDim2.new(0, 40, 0, 28); speed.Position = UDim2.new(0.52, 0, 0.4, 0)
speed.TextColor3 = Color3.new(1, 1, 1); speed.Font = Enum.Font.GothamBold; speed.TextSize = 14; speed.BackgroundTransparency = 1

local close = CreateBtn("ğŸ±", UDim2.new(0, -35, 0, 0), UDim2.new(0, 30, 0, 30))
local mini = CreateBtn("-", UDim2.new(1, 5, 0, 0), UDim2.new(0, 30, 0, 30))
local mini2 = CreateBtn("+", UDim2.new(1, 5, 0, 35), UDim2.new(0, 30, 0, 30)); mini2.Visible = false

-- ğŸŒˆ éœ“è™¹å‘¼å¸å‹•ç•«
task.spawn(function()
    while main.Parent do
        local hue = tick() % 5 / 5
        local color = Color3.fromHSV(hue, 0.5, 1)
        Tween(GlassStroke, {1}, {Color = color})
        Tween(title, {1}, {TextColor3 = color})
        task.wait(1)
    end
end)

-- [[ ğŸ§  æ ¸å¿ƒé‚è¼¯æ•´åˆ ]]
local F_Class = {}
F_Class.__index = F_Class
function F_Class.new()
    local self = setmetatable({}, F_Class)
    self.v = 1; self.f = false; self.n = false; self.c = {}; self.l = nil; self.w = {}; self.p = {}; self.pl = plr
    self:uC(); return self
end

function F_Class:uC() self.ch = self.pl.Character; if self.ch then self.h = self.ch:FindFirstChildWhichIsA("Humanoid"); self.r = self.ch:FindFirstChild("HumanoidRootPart") end end
function F_Class:sW() self:sW2(); for i=1, self.v do local x = run.Heartbeat:Connect(function() if self.ch and self.h and self.h.MoveDirection.Magnitude > 0 then self.ch:TranslateBy(self.h.MoveDirection) end end) table.insert(self.w, x) end end
function F_Class:sW2() for _,x in ipairs(self.w) do x:Disconnect() end; self.w = {} end
function F_Class:clP() for _,x in ipairs(self.p) do x:Destroy() end; self.p = {} end

function F_Class:aN() -- ç©¿ç‰†é–‹å•Ÿ
    self:sN()
    self.nc = self.ch.DescendantAdded:Connect(function(x) if x:IsA("BasePart") then x.CanCollide = false end end)
    self.nl = run.Heartbeat:Connect(function() if self.ch and self.n then for _,x in ipairs(self.ch:GetDescendants()) do if x:IsA("BasePart") then x.CanCollide = false end end end end)
end
function F_Class:rN() if self.nc then self.nc:Disconnect() end; if self.nl then self.nl:Disconnect() end; for _,x in ipairs(self.ch:GetDescendants()) do if x:IsA("BasePart") then x.CanCollide = true end end end
function F_Class:sN() if self.nc then self.nc:Disconnect() end; if self.nl then self.nl:Disconnect() end end

function F_Class:tF() -- é£›è¡Œé–‹é—œ
    self:uC(); if not self.ch then return end
    self.f = not self.f
    onof.Text = self.f and "åœæ­¢" or "è²“é£›è¡Œ"
    Tween(onof, {0.2}, {BackgroundColor3 = self.f and C.Accent or C.BtnBG})
    if self.f then
        self.ch.Animate.Disabled = true
        for _,v in next, self.h:GetPlayingAnimationTracks() do v:AdjustSpeed(0) end
        self:sW(); self:sR15()
    else
        self:sW2(); self:clP(); self.ch.Animate.Disabled = false; self.h.PlatformStand = false
    end
end

function F_Class:sR15()
    local t = self.ch:FindFirstChild("UpperTorso") or self.ch:FindFirstChild("Torso")
    local g = Instance.new("BodyGyro", t); g.P = 9e4; g.maxTorque = Vector3.new(9e9, 9e9, 9e9); g.cframe = t.CFrame
    local v = Instance.new("BodyVelocity", t); v.velocity = Vector3.new(0, 0.1, 0); v.maxForce = Vector3.new(9e9, 9e9, 9e9)
    table.insert(self.p, g); table.insert(self.p, v); self.h.PlatformStand = true
    local cs = 0; local m = 50
    self.l = run.Heartbeat:Connect(function()
        if not self.f then self.l:Disconnect(); return end
        local move = Vector3.new(0,0,0)
        if uis:IsKeyDown(Enum.KeyCode.W) then move = move + Camera.CFrame.LookVector end
        if uis:IsKeyDown(Enum.KeyCode.S) then move = move - Camera.CFrame.LookVector end
        if uis:IsKeyDown(Enum.KeyCode.A) then move = move - Camera.CFrame.RightVector end
        if uis:IsKeyDown(Enum.KeyCode.D) then move = move + Camera.CFrame.RightVector end
        if move.Magnitude > 0 then cs = math.min(cs + 1, m) else cs = math.max(cs - 1, 0) end
        v.velocity = move.Unit * cs * self.v; g.cframe = Camera.CFrame
    end)
end

local fm = F_Class.new()

-- [[ æŒ‰éˆ•åŠŸèƒ½ç¶å®š ]]
onof.MouseButton1Click:Connect(function() fm:tF() end)

noclipBtn.MouseButton1Click:Connect(function()
    fm.n = not fm.n
    noclipBtn.Text = fm.n and "ç©¿ç‰†: é–‹ ğŸ¾" or "ç©¿ç‰†: é—œ"
    Tween(noclipBtn, {0.2}, {BackgroundColor3 = fm.n and C.Accent or C.BtnBG})
    if fm.n then fm:aN() else fm:rN() end
end)

plus.MouseButton1Click:Connect(function() fm.v = math.min(fm.v + 1, 150); speed.Text = fm.v; if fm.f then fm:sW() end end)
mine.MouseButton1Click:Connect(function() fm.v = math.max(fm.v - 1, 1); speed.Text = fm.v; if fm.f then fm:sW() end end)

local mt; local function sm(x) if mt then mt:Disconnect() end; mt = run.Heartbeat:Connect(function() if fm.r then fm.r.CFrame = fm.r.CFrame * CFrame.new(0, x, 0) end end) end
local function em() if mt then mt:Disconnect() end end
up.MouseButton1Down:Connect(function() sm(1) end); up.MouseButton1Up:Connect(em); up.MouseLeave:Connect(em)
down.MouseButton1Down:Connect(function() sm(-1) end); down.MouseButton1Up:Connect(em); down.MouseLeave:Connect(em)

-- UI æ§åˆ¶
local function toggleVis(v) for _, x in pairs(Frame:GetChildren()) do if x:IsA("TextButton") or x:IsA("TextLabel") then x.Visible = v end end end
mini.MouseButton1Click:Connect(function() toggleVis(false); mini2.Visible = true; close.Visible = true; Tween(Frame, {0.3}, {Size = UDim2.new(0, 45, 0, 45)}) end)
mini2.MouseButton1Click:Connect(function() Tween(Frame, {0.3}, {Size = UDim2.new(0, 220, 0, 110)}); task.wait(0.3); toggleVis(true); mini2.Visible = false end)
close.MouseButton1Click:Connect(function() if fm.f then fm:tF() end; fm:sN(); main:Destroy() end)

-- æ‹–å‹•æ”¯æ´
local dStart, sPos, drag; Frame.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then drag = true; dStart = i.Position; sPos = Frame.Position end end)
uis.InputChanged:Connect(function(i) if drag and i.UserInputType == Enum.UserInputType.MouseMovement then local d = i.Position - dStart; Frame.Position = UDim2.new(sPos.X.Scale, sPos.X.Offset + d.X, sPos.Y.Scale, sPos.Y.Offset + d.Y) end end)
uis.InputEnded:Connect(function() drag = false end)

print("ğŸŒ¸ è²“è²“é£›è¡Œ  æ•´åˆå®Œæˆï¼ç©¿ç‰†æ¨¡å¼å·²å°±ç·’å–µï½")
