local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local Workspace = game:GetService("Workspace")
local localPlayer = Players.LocalPlayer

if getgenv().NEKO_RUNNING then return end
getgenv().NEKO_RUNNING = true

StarterGui:SetCore("SendNotification", {Title = "NEKO BF", Text = "è…³æœ¬å•Ÿå‹•ä¸­... è¼‰å…¥ Sloth UI å–µï½", Duration = 6})

_G.Settings = {
    ClickDelay    = 0.2,
    AtkRange      = 2500,
    PullEnemies   = false,
    Mode          = "None",
    FOV           = 120,
    MaxZoom       = 1000,
    CatSpeedValue = 50,
    SpeedEnabled  = false,
    InfJump       = false,
    SuperJumpEnabled = false,
    SuperJumpHeight = 150,
    StickyEnabled = false,
    StickyTarget  = nil,
    AutoBuyFruit  = false,
    FruitESP      = false
}

_G.NekoRunning = true
_G.NekoAttack  = false
_G.AutoV4      = false
_G.NekoESP     = false
_G.V4Loaded    = false
_G.ESPLoaded   = false

local Remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")
local function Sea(cmd) pcall(function() Remote:InvokeServer(cmd) end) end

task.spawn(function()
    local Camera = workspace.CurrentCamera
    RunService.RenderStepped:Connect(function()
        if not _G.NekoRunning then return end
        pcall(function()
            Camera.FieldOfView = _G.Settings.FOV
            localPlayer.CameraMaxZoomDistance = _G.Settings.MaxZoom
            localPlayer.CameraMinZoomDistance = 0
            
            local char = localPlayer.Character
            if char and char:FindFirstChild("Humanoid") then
                local hum = char.Humanoid
                if _G.Settings.SpeedEnabled then hum.WalkSpeed = _G.Settings.CatSpeedValue end
            end
        end)
    end)
end)

task.spawn(function()
    while true do
        task.wait(3)
        if _G.AutoV4 and not _G.V4Loaded then
            pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/V4"))()
                _G.V4Loaded = true
            end)
        elseif not _G.AutoV4 then
            _G.V4Loaded = false
        end
    end
end)

local function NuclearClean()
    local targets = {"Neko_PinkCyber_UI"}  -- é€™å€‹ library ç”¨çš„ ScreenGui åç¨±
    for _, name in ipairs(targets) do
        local obj = CoreGui:FindFirstChild(name)
        if obj then pcall(function() obj:Destroy() end) end
    end
end

NuclearClean()  -- å…ˆæ¸…ä¸€æ¬¡èˆŠçš„

local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/UI"))()

local window = library.new("NEKO BF")  -- å»ºç«‹è¦–çª—

-- ç‹€æ…‹ Tab (ç”¨ Button é¡¯ç¤ºç‹€æ…‹ï¼Œé»æ“Šç„¡ä½œç”¨)
local statusTab = window:Tab("ğŸ¾ è²“å’ªç‹€æ…‹")
local statusSec = statusTab:Section("å–µå–µç‹€æ…‹é¢æ¿")

local atkStatus = statusSec:Button("âš”ï¸ æ”»æ“Šï¼šğŸ”´ ä¼‘æ¯ä¸­")
local modeStatus = statusSec:Button("ğŸ§  æ¨¡å¼ï¼šä¼‘æ¯ä¸­")
local speedStatus = statusSec:Button("ğŸ± åŠ é€Ÿï¼šé—œé–‰")
local v4Status = statusSec:Button("âœ¨ V4ï¼šé—œé–‰")
local espStatus = statusSec:Button("ğŸ‘ï¸ é€è¦–ï¼šé—œé–‰")
local jumpStatus = statusSec:Button("ğŸ¾ è·³èºï¼šé—œé–‰")
local fruitStatus = statusSec:Button("ğŸ æœå¯¦ï¼šé—œé–‰")

task.spawn(function()
    while task.wait(1.5) do
        pcall(function()
            atkStatus.Text = "âš”ï¸ æ”»æ“Šï¼š" .. (_G.NekoAttack and "ğŸŸ¢ ç‹‚ç ä¸­" or "ğŸ”´ ä¼‘æ¯ä¸­")
            local modeText = (_G.Settings.Mode == "Mob" and "ğŸ‘¹ è‡ªå‹•æ‰“æ€ª") or (_G.Settings.Mode == "All" and "ğŸ’€ å…¨æ®ºæ¨¡å¼") or "ğŸ˜´ ä¼‘æ¯ä¸­"
            modeStatus.Text = "ğŸ§  æ¨¡å¼ï¼š" .. modeText
            speedStatus.Text = "ğŸ± åŠ é€Ÿï¼š" .. (_G.Settings.SpeedEnabled and "ğŸŸ¢ " .. _G.Settings.CatSpeedValue or "ğŸ”´ é—œé–‰")
            v4Status.Text = "âœ¨ V4ï¼š" .. (_G.AutoV4 and "ğŸŸ¢ è¦ºé†’ä¸­" or "ğŸ”´ é—œé–‰")
            espStatus.Text = "ğŸ‘ï¸ é€è¦–ï¼š" .. (_G.NekoESP and "ğŸŸ¢ å…¨é–‹" or "ğŸ”´ é—œé–‰")
            local jumpActive = _G.Settings.InfJump or _G.Settings.SuperJumpEnabled
            jumpStatus.Text = "ğŸ¾ è·³èºï¼š" .. (jumpActive and "ğŸŸ¢ å•Ÿå‹•" or "ğŸ”´ é—œé–‰")
            fruitStatus.Text = "ğŸ æœå¯¦ï¼š" .. (_G.Settings.FruitESP and "ğŸŸ¢ é›·é”" or "ğŸ”´ é—œé–‰")
        end)
    end
end)

-- æˆ°é¬¥ Tab
local fightTab = window:Tab("âš”ï¸ æˆ°é¬¥")
local fightSec = fightTab:Section("æ ¸å¿ƒæ”¶å‰²")

fightSec:Toggle("ç¥åˆ€é€£æ“Š", function(s) _G.NekoAttack = s end)
fightSec:Toggle("è²“æŠ“æ‹‰æ€ª", function(s) _G.Settings.PullEnemies = s end)
fightSec:Toggle("è‡ªå‹• V4", function(s) 
    _G.AutoV4 = s 
    if s then
        StarterGui:SetCore("SendNotification", {Title = "NEKO V4", Text = "è‡ªå‹•è¦ºé†’å•Ÿå‹•ï¼å–µï½", Duration = 4})
    end
end)
fightSec:Button("ğŸ‘¹ è‡ªå‹•æ‰“æ€ª", function() _G.Settings.Mode = "Mob"; _G.NekoAttack = true end)
fightSec:Button("ğŸ’€ å…¨æ®ºæ¨¡å¼", function() _G.Settings.Mode = "All"; _G.NekoAttack = true end)
fightSec:Button("ğŸ›‘ åœæ­¢æˆ°é¬¥", function() _G.Settings.Mode = "None"; _G.NekoAttack = false end)

-- ç’°å¢ƒ Tab
local envTab = window:Tab("ğŸ‘ï¸ ç’°å¢ƒ")
local visualSec = envTab:Section("è¦–è¦º")
visualSec:Textbox("FOV (30-160)", tostring(_G.Settings.FOV), function(v)
    local num = tonumber(v)
    if num then _G.Settings.FOV = math.clamp(num, 30, 160) end
end)
visualSec:Textbox("Zoom (1-10000)", tostring(_G.Settings.MaxZoom), function(v)
    local num = tonumber(v)
    if num then _G.Settings.MaxZoom = math.clamp(num, 1, 10000) end
end)
visualSec:Toggle("è²“è²“é€è¦–", function(s)
    _G.NekoESP = s
    if s and not _G.ESPLoaded then
        _G.ESPLoaded = true
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/ESP"))()
        end)
    end
end)

local effSec = envTab:Section("æ•ˆèƒ½")
effSec:Button("FPS å„ªåŒ–", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/FPS"))()
    end)
end)

-- ç§»å‹• Tab
local moveTab = window:Tab("ğŸ± ç§»å‹•")
local moveSec = moveTab:Section("è²“å’ªç§»å‹•")
moveSec:Toggle("è²“å’ªåŠ é€Ÿ", function(s) _G.Settings.SpeedEnabled = s end)
moveSec:Textbox("åŠ é€Ÿæ•¸å€¼", tostring(_G.Settings.CatSpeedValue), function(v)
    local num = tonumber(v)
    if num then _G.Settings.CatSpeedValue = num end
end)
moveSec:Toggle("ç„¡é™è·³èº", function(s) _G.Settings.InfJump = s end)
moveSec:Toggle("è¶…ç´šè²“è·³", function(s) _G.Settings.SuperJumpEnabled = s end)
moveSec:Textbox("è·³èºé«˜åº¦", tostring(_G.Settings.SuperJumpHeight), function(v)
    local num = tonumber(v)
    if num then _G.Settings.SuperJumpHeight = num end
end)
moveSec:Button("è²“è²“é£›è¡Œå™¨", function()
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/FLY"))()
    end)
end)

-- å‚³é€ Tab
local tpTab = window:Tab("ğŸŒŠ å‚³é€")
local tpSec = tpTab:Section("è·¨æµ·å‚³é€")
tpSec:Button("ğŸï¸ ä¸€æµ·", function() Sea("TravelMain") end)
tpSec:Button("ğŸ° äºŒæµ·", function() Sea("TravelDressrosa") end)
tpSec:Button("ğŸ˜ ä¸‰æµ·", function() Sea("TravelZou") end)

-- æœå¯¦ Tab
local fruitTab = window:Tab("ğŸ æœå¯¦")
local radarSec = fruitTab:Section("æœå¯¦é›·é”")
radarSec:Toggle("æœå¯¦é€è¦–", function(s) _G.Settings.FruitESP = s end)
radarSec:Button("ğŸš€ ç«‹å³æ’¿æœ", function()
    local hrp = localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    for _, v in pairs(Workspace:GetChildren()) do
        if v:IsA("Tool") and (v.Name:find("Fruit") or v:FindFirstChild("Handle")) then
            hrp.CFrame = (v:FindFirstChild("Handle") or v.PrimaryPart).CFrame + Vector3.new(0, 2, 0)
        end
    end
end)

local drawSec = fruitTab:Section("æŠ½ç")
drawSec:Toggle("è‡ªå‹•æŠ½æœ", function(s) _G.Settings.AutoBuyFruit = s end)
drawSec:Button("ğŸ° æ‰‹å‹•æŠ½ç", function() Remote:InvokeServer("Cousin", "Buy") end)

-- æ”»æ“Šè¿´åœˆï¼ˆåŸæ¨£ï¼‰
task.spawn(function()
    local RA = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterAttack")
    local RH = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterHit")
    while task.wait(0.05) do
        if _G.NekoAttack then
            pcall(function()
                local ts = {}
                local function find(f)
                    for _, e in pairs(f:GetChildren()) do
                        if #ts > 15 then break end
                        if e:FindFirstChild("Humanoid") and e.Humanoid.Health > 0 then
                            local p = e:FindFirstChild("HumanoidRootPart") or e.PrimaryPart
                            if p and localPlayer:DistanceFromCharacter(p.Position) < _G.Settings.AtkRange then
                                table.insert(ts, {e, p})
                            end
                        end
                    end
                end
                if _G.Settings.Mode == "All" then find(workspace.Enemies); find(workspace.Characters)
                elseif _G.Settings.Mode == "Mob" then find(workspace.Enemies) end
                if #ts > 0 then RA:FireServer(_G.Settings.ClickDelay); RH:FireServer(ts[1][2], ts) end
            end)
        end
    end
end)

-- è·³èºè™•ç†
UserInputService.JumpRequest:Connect(function()
    local hum = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Humanoid")
    if hum and (_G.Settings.InfJump or _G.Settings.SuperJumpEnabled) then
        if _G.Settings.SuperJumpEnabled then hum.JumpPower = _G.Settings.SuperJumpHeight end
        hum:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- ç†±éµ Toggle UI (Insert éµé–‹é—œè¦–çª—)
UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.KeyCode == Enum.KeyCode.Insert then
        window:Toggle()
    end
end)

print("[NEKO BF] Sloth UI è¼‰å…¥å®Œæˆï¼æŒ‰ Insert é–‹/é—œ UI")
StarterGui:SetCore("SendNotification", {Title = "NEKO BF", Text = "å•Ÿå‹•æˆåŠŸï¼æŒ‰ Insert éµé–‹å•Ÿ/é—œé–‰ UI å–µï½", Duration = 8})
