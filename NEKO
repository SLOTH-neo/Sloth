-- [[ä¸»è…³æœ¬]] --
-- [[ NEKO CORE V3 - çµ‚æ¥µå…¨åŠŸèƒ½ç‰ˆ ]]
-- æ•´åˆåŠŸèƒ½ï¼šé›™é‡è¦–é‡ç¸®æ”¾ã€ç¥åˆ€å¿«æ”»ã€è‡ªå‹•æ‰“æ€ªã€ç§»å‹•å¼·åŒ–ã€æœå¯¦é›·é”

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local localPlayer = Players.LocalPlayer

if getgenv().NEKO_RUNNING then return end
getgenv().NEKO_RUNNING = true

-- 1. æ ¸å¿ƒé…ç½®èˆ‡åˆå§‹å€¼
_G.Settings = {
    ClickDelay    = 0.1,
    AtkRange      = 500,
    PullEnemies   = false,
    Mode          = "None",
    FOV           = 80,   -- è¦–é‡è§’åº¦
    MaxZoom       = 128,  -- é¡é ­è·é›¢
    CatSpeedValue = 50,
    SpeedEnabled  = false,
    InfJump       = false,
    SuperJumpEnabled = false,
    SuperJumpHeight = 150,
    StickyEnabled = false,
    StickyTarget  = nil,
    AutoBuyFruit  = false,
    FruitESP      = false
}

_G.NekoRunning = true
_G.NekoAttack  = false
_G.AutoV4      = false
_G.NekoESP     = false

local Remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")
local function Sea(cmd) pcall(function() Remote:InvokeServer(cmd) end) end

-- 2. æ ¸å¿ƒæ¸²æŸ“å¾ªç’° (è¦–è¦ºåŒæ­¥èˆ‡è§’è‰²å±¬æ€§)
task.spawn(function()
    local Camera = workspace.CurrentCamera
    RunService.RenderStepped:Connect(function()
        if not _G.NekoRunning then return end
        pcall(function()
            -- âœ¨ æ ¸å¿ƒè¦–é‡åŒæ­¥é‚è¼¯
            Camera.FieldOfView = _G.Settings.FOV
            localPlayer.CameraMaxZoomDistance = _G.Settings.MaxZoom
            localPlayer.CameraMinZoomDistance = 0
            
            -- è§’è‰²å±¬æ€§åŒæ­¥
            local char = localPlayer.Character
            if char and char:FindFirstChild("Humanoid") then
                local hum = char.Humanoid
                if _G.Settings.SpeedEnabled then
                    hum.WalkSpeed = _G.Settings.CatSpeedValue
                end
                if _G.AutoV4 then 
                    Remote:InvokeServer("RaceV4Control", true) 
                end
            end
        end)
    end)
end)

-- 3. æ¸…ç†èˆŠ UI èˆ‡ æº–å‚™
local function NuclearClean()
    local targets = {"NEKO BF", "NekoUI", "NekoStickyMenu", "NekoMainBtn", "NekoFruitESP"}
    for _, name in ipairs(targets) do
        local obj = CoreGui:FindFirstChild(name) or localPlayer.PlayerGui:FindFirstChild(name)
        if obj then pcall(function() obj:Destroy() end) end
    end
end
NuclearClean()
local FruitFolder = CoreGui:FindFirstChild("NekoFruitESP") or Instance.new("Folder", CoreGui)
FruitFolder.Name = "NekoFruitESP"

-- 4. è¼‰å…¥ UI åº«ä¸¦æ§‹å»ºåŠŸèƒ½
local success, UIContent = pcall(function()
    return game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/UI")
end)

if success then
    local NekoLib = loadstring(UIContent)()
    local myUI, screenGui = NekoLib.new("NEKO BF")
    pcall(function() screenGui.Parent = CoreGui end)
    if screenGui.Parent ~= CoreGui then screenGui.Parent = localPlayer.PlayerGui end

    task.spawn(function()
        -- [[ åˆ†é ï¼šæˆ°é¬¥ç³»çµ± ]]
        local TabFight = myUI:Tab("æˆ°é¬¥ç³»çµ±")
        local F_Core = TabFight:Section("æ ¸å¿ƒæ”¶å‰²ä¸­å¿ƒ")
        F_Core:Toggle("å•Ÿå‹•ç¥åˆ€é€£æ“Š (FastAttack)", function(s) _G.NekoAttack = s end)
        F_Core:Toggle("é–‹å•Ÿè²“æŠ“æ‹‰æ€ª (Pull)", function(s) _G.Settings.PullEnemies = s end)
        F_Core:Toggle("è‡ªå‹•è¦ºé†’ V4", function(s) _G.AutoV4 = s end)
        F_Core:Button("ğŸ§  æ¨¡å¼ï¼šè‡ªå‹•æ‰“æ€ª (Mob)", function() _G.Settings.Mode = "Mob"; _G.NekoAttack = true end)
        F_Core:Button("ğŸ”¥ æ¨¡å¼ï¼šå…¨æ®ºæ¨¡å¼ (All)", function() _G.Settings.Mode = "All"; _G.NekoAttack = true end)
        F_Core:Button("ğŸ›‘ åœæ­¢æˆ°é¬¥", function() _G.Settings.Mode = "None"; _G.NekoAttack = false end)

        -- [[ åˆ†é ï¼šç’°å¢ƒå„ªåŒ– (åŒ…å« FOV é‚è¼¯) ]]
        local TabEnv = myUI:Tab("ç’°å¢ƒå„ªåŒ–")
        local VisualSec = TabEnv:Section("è¦–è¦ºå¢å¼·")
        VisualSec:Textbox("è¦–é‡è§’åº¦ (FOV)", "80", function(v)
            local num = tonumber(v)
            if num then _G.Settings.FOV = math.clamp(num, 30, 160) end
        end)
        VisualSec:Textbox("é¡é ­è·é›¢ (Zoom)", "128", function(v)
            local num = tonumber(v)
            if num then _G.Settings.MaxZoom = math.clamp(num, 1, 10000) end
        end)
        VisualSec:Toggle("é–‹å•Ÿè²“è²“é€è¦– (ESP)", function(s)
            _G.NekoESP = s
            if s and not _G.ESPLoaded then
                _G.ESPLoaded = true
                loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/ESP"))()
            end
        end)

        -- [[ åˆ†é ï¼šç§»å‹•å‚³é€ ]]
        local TabMove = myUI:Tab("ç§»å‹•å‚³é€")
        local M1 = TabMove:Section("è§’è‰²ç§»å‹•")
        M1:Toggle("é–‹å•Ÿç§»å‹•åŠ é€Ÿ", function(s) _G.Settings.SpeedEnabled = s end)
        M1:Textbox("åŠ é€Ÿæ•¸å€¼", "50", function(v)
            local num = tonumber(v)
            if num then _G.Settings.CatSpeedValue = num end
        end)
        M1:Toggle("é–‹å•Ÿç„¡é™è·³èº", function(s) _G.Settings.InfJump = s end)
        M1:Toggle("è¶…ç´šè·³èº", function(s) _G.Settings.SuperJumpEnabled = s end)
        M1:Button("å¬å–šè²“è²“é£›è¡Œå™¨", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/FLY"))()
        end)
        
        local TP = TabMove:Section("è·¨æµ·å‚³é€")
        TP:Button("å‰å¾€ï¼šä¸€æµ·", function() Sea("TravelMain") end)
        TP:Button("å‰å¾€ï¼šäºŒæµ·", function() Sea("TravelDressrosa") end)
        TP:Button("å‰å¾€ï¼šä¸‰æµ·", function() Sea("TravelZou") end)

        -- [[ åˆ†é ï¼šæœå¯¦ç³»çµ± ]]
        local TabFruit = myUI:Tab("æœå¯¦ç³»çµ±")
        TabFruit:Section("é›·é”"):Toggle("é–‹å•Ÿæœå¯¦é€è¦–", function(s) _G.Settings.FruitESP = s end)
        TabFruit:Section("è‡ªå‹•"):Toggle("è‡ªå‹•æŠ½æœå¯¦", function(s) _G.Settings.AutoBuyFruit = s end)
    end)
end

-- 5. æˆ°é¬¥é‚è¼¯æ ¸å¿ƒ (å¿«æ”»èˆ‡ç›®æ¨™æœç´¢)
task.spawn(function()
    local RA = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterAttack")
    local RH = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterHit")
    while task.wait() do
        if _G.NekoAttack then
            pcall(function()
                local targets = {}
                local function find(folder)
                    for _, e in pairs(folder:GetChildren()) do
                        if e:FindFirstChild("Humanoid") and e.Humanoid.Health > 0 then
                            local part = e:FindFirstChild("HumanoidRootPart") or e.PrimaryPart
                            if part and localPlayer:DistanceFromCharacter(part.Position) < _G.Settings.AtkRange then
                                table.insert(targets, {e, part})
                            end
                        end
                    end
                end
                
                if _G.Settings.Mode == "All" then find(workspace.Enemies); find(workspace.Characters)
                elseif _G.Settings.Mode == "Mob" then find(workspace.Enemies) end
                
                if #targets > 0 then
                    RA:FireServer(_G.Settings.ClickDelay)
                    RH:FireServer(targets[1][2], targets)
                end
            end)
        end
        task.wait(_G.Settings.ClickDelay)
    end
end)

-- ç„¡é™è·³èºç›£è½
UserInputService.JumpRequest:Connect(function()
    local hum = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Humanoid")
    if hum and (_G.Settings.InfJump or _G.Settings.SuperJumpEnabled) then
        if _G.Settings.SuperJumpEnabled then hum.JumpPower = _G.Settings.SuperJumpHeight end
        hum:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

print("NEKO PROJECT V3 çµ‚æ¥µè¼‰å…¥å®Œæˆå–µï¼ğŸ¾")
