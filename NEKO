local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local StarterGui = game:GetService("StarterGui")
local localPlayer = Players.LocalPlayer

if getgenv().NEKO_RUNNING then return end
getgenv().NEKO_RUNNING = true

StarterGui:SetCore("SendNotification", {Title = "NEKO BF", Text = "è…³æœ¬å•Ÿå‹•ä¸­... è¼‰å…¥ WindUI å–µï½", Duration = 6})

_G.Settings = {
    ClickDelay    = 0.2,
    AtkRange      = 2500,
    PullEnemies   = false,
    Mode          = "None",
    FOV           = 120,
    MaxZoom       = 1000,
    CatSpeedValue = 50,
    SpeedEnabled  = false,
    InfJump       = false,
    SuperJumpEnabled = false,
    SuperJumpHeight = 150,
    StickyEnabled = false,
    StickyTarget  = nil,
    AutoBuyFruit  = false,
    FruitESP      = false
}

_G.NekoRunning = true
_G.NekoAttack  = false
_G.AutoV4      = false
_G.NekoESP     = false
_G.V4Loaded    = false
_G.ESPLoaded   = false

local Remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")
local function Sea(cmd) pcall(function() Remote:InvokeServer(cmd) end) end

task.spawn(function()
    local Camera = workspace.CurrentCamera
    RunService.RenderStepped:Connect(function()
        if not _G.NekoRunning then return end
        pcall(function()
            Camera.FieldOfView = _G.Settings.FOV
            localPlayer.CameraMaxZoomDistance = _G.Settings.MaxZoom
            localPlayer.CameraMinZoomDistance = 0
            
            local char = localPlayer.Character
            if char and char:FindFirstChild("Humanoid") then
                local hum = char.Humanoid
                if _G.Settings.SpeedEnabled then hum.WalkSpeed = _G.Settings.CatSpeedValue end
            end
        end)
    end)
end)

task.spawn(function()
    while true do
        task.wait(3)
        if _G.AutoV4 and not _G.V4Loaded then
            pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/V4"))()
                _G.V4Loaded = true
            end)
        elseif not _G.AutoV4 then
            _G.V4Loaded = false
        end
    end
end)

local function NuclearClean()
    local targets = {"NEKO BF", "NekoUI", "NekoStickyMenu", "NekoMainBtn", "NekoFruitESP"}
    for _, name in ipairs(targets) do
        local obj = CoreGui:FindFirstChild(name) or localPlayer.PlayerGui:FindFirstChild(name)
        if obj then pcall(function() obj:Destroy() end) end
    end
end

NuclearClean()

local FruitFolder = CoreGui:FindFirstChild("NekoFruitESP") or Instance.new("Folder", CoreGui)
FruitFolder.Name = "NekoFruitESP"

local success, WindUIContent = pcall(function()
    return game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/main.lua")
end)

if success then
    local WindUILoadSuccess, WindUI = pcall(loadstring(WindUIContent))
    if not WindUILoadSuccess then
        warn("[NEKO] WindUI loadstring å¤±æ•—: " .. tostring(WindUI))
        StarterGui:SetCore("SendNotification", {Title = "NEKO éŒ¯èª¤", Text = "WindUI è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥é€£çµæˆ– executor", Duration = 10})
        return
    end

    local Window = WindUI:CreateWindow({
        Title = "ğŸ¾ NEKO BF ğŸ¾",
        Icon = "rbxassetid://7733960981",
        Author = "å–µå–µå¤–æ›",
        Folder = "NekoBF",
        Size = UDim2.fromOffset(580, 490),
        Theme = "Dark",
        Acrylic = false,
        OpenButton = {
            Title = "é–‹å•Ÿ NEKO",
            CornerRadius = UDim.new(1, 0),
            Color = ColorSequence.new(Color3.fromRGB(255, 100, 180), Color3.fromRGB(255, 200, 255))
        }
    })

    StarterGui:SetCore("SendNotification", {Title = "NEKO BF", Text = "WindUI è¼‰å…¥æˆåŠŸï¼åˆå§‹åŒ–ä»‹é¢...", Duration = 4})

    local TabStatus = Window:Tab({ Title = "ğŸ¾ è²“å’ªç‹€æ…‹", Icon = "rbxassetid://7733960981" })
    local StatusSec = TabStatus:Section({ Title = "å–µå–µç‹€æ…‹é¢æ¿", Opened = true })
    
    local StatusBtns = {}
    StatusBtns.Atk = StatusSec:Button({ Title = "âš”ï¸ æ”»æ“Šï¼šğŸ”´ ä¼‘æ¯ä¸­" })
    StatusBtns.Mode = StatusSec:Button({ Title = "ğŸ§  æ¨¡å¼ï¼šä¼‘æ¯ä¸­" })
    StatusBtns.Speed = StatusSec:Button({ Title = "ğŸ± åŠ é€Ÿï¼šé—œé–‰" })
    StatusBtns.V4 = StatusSec:Button({ Title = "âœ¨ V4ï¼šé—œé–‰" })
    StatusBtns.ESP = StatusSec:Button({ Title = "ğŸ‘ï¸ é€è¦–ï¼šé—œé–‰" })
    StatusBtns.Jump = StatusSec:Button({ Title = "ğŸ¾ è·³èºï¼šé—œé–‰" })
    StatusBtns.Fruit = StatusSec:Button({ Title = "ğŸ æœå¯¦ï¼šé—œé–‰" })
    
    task.spawn(function()
        while task.wait(2) do
            pcall(function()
                StatusBtns.Atk.Title = "âš”ï¸ æ”»æ“Šï¼š" .. (_G.NekoAttack and "ğŸŸ¢ å–µå–µç‹‚ç ä¸­" or "ğŸ”´ å–µå–µä¼‘æ¯ä¸­")
                local modeText = (_G.Settings.Mode == "Mob" and "ğŸ‘¹ è‡ªå‹•æ‰“æ€ª") or (_G.Settings.Mode == "All" and "ğŸ’€ å…¨æ®ºæ¨¡å¼") or "ğŸ˜´ ä¼‘æ¯ä¸­"
                StatusBtns.Mode.Title = "ğŸ§  æ¨¡å¼ï¼š" .. modeText
                StatusBtns.Speed.Title = "ğŸ± åŠ é€Ÿï¼š" .. (_G.Settings.SpeedEnabled and "ğŸŸ¢ " .. _G.Settings.CatSpeedValue or "ğŸ”´ é—œé–‰")
                StatusBtns.V4.Title = "âœ¨ V4ï¼š" .. (_G.AutoV4 and "ğŸŸ¢ å–µå–µè¦ºé†’ä¸­" or "ğŸ”´ é—œé–‰")
                StatusBtns.ESP.Title = "ğŸ‘ï¸ é€è¦–ï¼š" .. (_G.NekoESP and "ğŸŸ¢ å–µçœ¼å…¨é–‹" or "ğŸ”´ é—œé–‰")
                local jumpActive = _G.Settings.InfJump or _G.Settings.SuperJumpEnabled
                StatusBtns.Jump.Title = "ğŸ¾ è·³èºï¼š" .. (jumpActive and "ğŸŸ¢ å–µè·³å•Ÿå‹•" or "ğŸ”´ é—œé–‰")
                StatusBtns.Fruit.Title = "ğŸ æœå¯¦ï¼š" .. (_G.Settings.FruitESP and "ğŸŸ¢ æœå¯¦é›·é”" or "ğŸ”´ é—œé–‰")
            end)
        end
    end)

    local TabFight = Window:Tab({ Title = "âš”ï¸ æˆ°é¬¥", Icon = "rbxassetid://7733960981" })
    local F_Core = TabFight:Section({ Title = "æ ¸å¿ƒæ”¶å‰²", Opened = true })
    F_Core:Toggle({ Title = "ç¥åˆ€é€£æ“Š", Callback = function(s) _G.NekoAttack = s end })
    F_Core:Toggle({ Title = "è²“æŠ“æ‹‰æ€ª", Callback = function(s) _G.Settings.PullEnemies = s end })
    F_Core:Toggle({ Title = "è‡ªå‹• V4", Callback = function(s) 
        _G.AutoV4 = s 
        if s then
            StarterGui:SetCore("SendNotification", {
                Title = "ğŸ¾ NEKO V4",
                Text = "å–µå–µè‡ªå‹•è¦ºé†’å•Ÿå‹•ï¼èƒ½é‡æ»¿æ»¿å–µï½",
                Duration = 4
            })
        end
    end })
    F_Core:Button({ Title = "ğŸ‘¹ è‡ªå‹•æ‰“æ€ª", Callback = function() _G.Settings.Mode = "Mob"; _G.NekoAttack = true end })
    F_Core:Button({ Title = "ğŸ’€ å…¨æ®ºæ¨¡å¼", Callback = function() _G.Settings.Mode = "All"; _G.NekoAttack = true end })
    F_Core:Button({ Title = "ğŸ›‘ åœæ­¢æˆ°é¬¥", Callback = function() _G.Settings.Mode = "None"; _G.NekoAttack = false end })

    local TabEnv = Window:Tab({ Title = "ğŸ‘ï¸ ç’°å¢ƒ", Icon = "rbxassetid://7733960981" })
    local VisualSec = TabEnv:Section({ Title = "è¦–è¦º", Opened = true })
    VisualSec:Input({ Title = "FOV", Value = "80", Callback = function(v)
        local num = tonumber(v)
        if num then _G.Settings.FOV = math.clamp(num, 30, 160) end
    end })
    VisualSec:Input({ Title = "Zoom", Value = "128", Callback = function(v)
        local num = tonumber(v)
        if num then _G.Settings.MaxZoom = math.clamp(num, 1, 10000) end
    end })
    VisualSec:Toggle({ Title = "è²“è²“é€è¦–", Callback = function(s)
        _G.NekoESP = s
        if s and not _G.ESPLoaded then
            _G.ESPLoaded = true
            pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/ESP"))()
            end)
        end
    end })
    local EffSec = TabEnv:Section({ Title = "æ•ˆèƒ½", Opened = true })
    EffSec:Button({ Title = "FPS å„ªåŒ–", Callback = function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/FPS"))()
        end)
    end })
    
    local AppearanceSec = TabEnv:Section({ Title = "å¤–è§€ä¸»é¡Œ", Opened = true })
    AppearanceSec:Dropdown({ Title = "é¸æ“‡ä¸»é¡Œ", Options = WindUI:GetThemes(), Callback = function(selected)
        WindUI:SetTheme(selected)
        StarterGui:SetCore("SendNotification", {Title = "NEKO ä¸»é¡Œ", Text = "åˆ‡æ›åˆ° " .. selected .. " å–µï½", Duration = 3})
    end })
    AppearanceSec:Toggle({ Title = "åˆ‡æ› Dark/Light", Callback = function(s)
        WindUI:SetTheme(s and "Light" or "Dark")
        StarterGui:SetCore("SendNotification", {Title = "NEKO ä¸»é¡Œ", Text = "åˆ‡æ›åˆ° " .. (s and "Light" or "Dark") .. " å–µï½", Duration = 3})
    end })
    AppearanceSec:Button({ Title = "å‰µå»ºæ–°ä¸»é¡Œ", Callback = function()
        Window:Dialog({
            Title = "å‰µå»ºä¸»é¡Œ",
            Content = "é€™åŠŸèƒ½é‚„æ²’å¯¦ä½œï¼ˆcoming soonï¼‰ï¼Œå–µï½",
            Buttons = { { Title = "OK", Variant = "Primary" } }
        })
    end })

    local TabMove = Window:Tab({ Title = "ğŸ± ç§»å‹•", Icon = "rbxassetid://7733960981" })
    local M1 = TabMove:Section({ Title = "è²“å’ªç§»å‹•", Opened = true })
    M1:Toggle({ Title = "è²“å’ªåŠ é€Ÿ", Callback = function(s) _G.Settings.SpeedEnabled = s end })
    M1:Input({ Title = "åŠ é€Ÿæ•¸å€¼", Value = "50", Callback = function(v)
        local num = tonumber(v)
        if num then _G.Settings.CatSpeedValue = num end
    end })
    M1:Toggle({ Title = "ç„¡é™è·³èº", Callback = function(s) _G.Settings.InfJump = s end })
    M1:Toggle({ Title = "è¶…ç´šè²“è·³", Callback = function(s) _G.Settings.SuperJumpEnabled = s end })
    M1:Input({ Title = "è·³èºé«˜åº¦", Value = "150", Callback = function(v)
        local num = tonumber(v)
        if num then _G.Settings.SuperJumpHeight = num end
    end })
    M1:Button({ Title = "è²“è²“é£›è¡Œå™¨", Callback = function()
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/FLY"))()
        end)
    end })

    local TabTP = Window:Tab({ Title = "ğŸŒŠ å‚³é€", Icon = "rbxassetid://7733960981" })
    local TP = TabTP:Section({ Title = "è·¨æµ·å‚³é€", Opened = true })
    TP:Button({ Title = "ğŸï¸ ä¸€æµ·", Callback = function() Sea("TravelMain") end })
    TP:Button({ Title = "ğŸ° äºŒæµ·", Callback = function() Sea("TravelDressrosa") end })
    TP:Button({ Title = "ğŸ˜ ä¸‰æµ·", Callback = function() Sea("TravelZou") end })

    local TabFruit = Window:Tab({ Title = "ğŸ æœå¯¦", Icon = "rbxassetid://7733960981" })
    local FruitRadar = TabFruit:Section({ Title = "æœå¯¦é›·é”", Opened = true })
    FruitRadar:Toggle({ Title = "æœå¯¦é€è¦–", Callback = function(s) _G.Settings.FruitESP = s end })
    FruitRadar:Button({ Title = "ğŸš€ ç«‹å³æ’¿æœ", Callback = function()
        local hrp = localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart")
        if not hrp then return end
        for _, v in pairs(Workspace:GetChildren()) do
            if v:IsA("Tool") and (v.Name:find("Fruit") or v:FindFirstChild("Handle")) then
                hrp.CFrame = (v:FindFirstChild("Handle") or v.PrimaryPart).CFrame + Vector3.new(0, 2, 0)
            end
        end
    end })
    local FruitSec = TabFruit:Section({ Title = "æŠ½ç", Opened = true })
    FruitSec:Toggle({ Title = "è‡ªå‹•æŠ½æœ", Callback = function(s) _G.Settings.AutoBuyFruit = s end })
    FruitSec:Button({ Title = "ğŸ° æ‰‹å‹•æŠ½ç", Callback = function() Remote:InvokeServer("Cousin", "Buy") end })

    task.spawn(function()
        local RA = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterAttack")
        local RH = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterHit")
        while task.wait(0.05) do
            if _G.NekoAttack then
                pcall(function()
                    local ts = {}
                    local function find(f)
                        for _, e in pairs(f:GetChildren()) do
                            if #ts > 15 then break end
                            if e:FindFirstChild("Humanoid") and e.Humanoid.Health > 0 then
                                local p = e:FindFirstChild("HumanoidRootPart") or e.PrimaryPart
                                if p and localPlayer:DistanceFromCharacter(p.Position) < _G.Settings.AtkRange then
                                    table.insert(ts, {e, p})
                                end
                            end
                        end
                    end
                    if _G.Settings.Mode == "All" then find(workspace.Enemies); find(workspace.Characters)
                    elseif _G.Settings.Mode == "Mob" then find(workspace.Enemies) end
                    if #ts > 0 then RA:FireServer(_G.Settings.ClickDelay); RH:FireServer(ts[1][2], ts) end
                end)
            end
        end
    end)

    UserInputService.JumpRequest:Connect(function()
        local hum = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Humanoid")
        if hum and (_G.Settings.InfJump or _G.Settings.SuperJumpEnabled) then
            if _G.Settings.SuperJumpEnabled then hum.JumpPower = _G.Settings.SuperJumpHeight end
            hum:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end)

    print("[NEKO BF] WindUI å°æ¥å®Œæˆï¼")
    StarterGui:SetCore("SendNotification", {Title = "NEKO BF", Text = "è…³æœ¬å•Ÿå‹•æˆåŠŸï¼æ‰¾è¢å¹•ä¸Šçš„é–‹é—œæŒ‰éˆ•å–µï½", Duration = 6})
else
    warn("[NEKO] WindUI HttpGet å¤±æ•—: " .. tostring(WindUIContent))
    StarterGui:SetCore("SendNotification", {Title = "NEKO éŒ¯èª¤", Text = "ç„¡æ³•é€£ç·šåˆ° WindUIï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–é€£çµ", Duration = 10})
end
