-- [[ NEKO PROJECT V3 - æ­£ç¢ºç‰ˆ (æœ‰ HttpGet é€£çµ) ]]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local localPlayer = Players.LocalPlayer

if getgenv().NEKO_RUNNING then return end
getgenv().NEKO_RUNNING = true

_G.Settings = {
    ClickDelay    = 0.1,
    AtkRange      = 2500,
    PullEnemies   = false,
    Mode          = "None",
    FOV           = 120,
    MaxZoom       = 128,
    CatSpeedValue = 50,
    SpeedEnabled  = false,
    InfJump       = false,
    SuperJumpEnabled = false,
    SuperJumpHeight = 150,
    StickyEnabled = false,
    StickyTarget  = nil,
    AutoBuyFruit  = false,
    FruitESP      = false
}

_G.NekoRunning = true
_G.NekoAttack  = false
_G.AutoV4      = false
_G.NekoESP     = false

local Remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")
local function Sea(cmd) pcall(function() Remote:InvokeServer(cmd) end) end

-- æ¸²æŸ“å¾ªç’° + V4
task.spawn(function()
    local Camera = workspace.CurrentCamera
    RunService.RenderStepped:Connect(function()
        if not _G.NekoRunning then return end
        pcall(function()
            Camera.FieldOfView = _G.Settings.FOV
            localPlayer.CameraMaxZoomDistance = _G.Settings.MaxZoom
            localPlayer.CameraMinZoomDistance = 0
            
            local char = localPlayer.Character
            if char and char:FindFirstChild("Humanoid") then
                local hum = char.Humanoid
                if _G.Settings.SpeedEnabled then hum.WalkSpeed = _G.Settings.CatSpeedValue end
                if _G.AutoV4 then
                    pcall(function()
                        Remote:InvokeServer("SetRaceV4", true)
                        Remote:InvokeServer("RaceV4", true)
                        if hum:GetAttribute("Awakening") or hum:GetAttribute("V4Awakening") then
                            Remote:InvokeServer("Awakening", true)
                        end
                    end)
                end
            end
        end)
    end)
end)

task.spawn(function()
    while task.wait(1) do
        if _G.AutoV4 then
            pcall(function()
                Remote:InvokeServer("SetRaceV4", true)
                Remote:InvokeServer("RaceV4", true)
            end)
        end
    end
end)

-- æ¸…ç†
local function NuclearClean()
    local targets = {"NEKO BF", "NekoUI", "NekoStickyMenu", "NekoMainBtn", "NekoFruitESP"}
    for _, name in ipairs(targets) do
        local obj = CoreGui:FindFirstChild(name) or localPlayer.PlayerGui:FindFirstChild(name)
        if obj then pcall(function() obj:Destroy() end) end
    end
end
NuclearClean()
local FruitFolder = CoreGui:FindFirstChild("NekoFruitESP") or Instance.new("Folder", CoreGui)
FruitFolder.Name = "NekoFruitESP"

-- è¼‰å…¥ libraryï¼ˆé€™è£¡æœ‰é€£çµï¼ï¼‰
local success, UIContent = pcall(function()
    return game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/main/UI")
end)

if success then
    print("æˆåŠŸæ‹‰åˆ° library äº†ï¼é•·åº¦ï¼š" .. #UIContent .. " å­—å…ƒ")
    local NekoLib = loadstring(UIContent)()
    local myUI, screenGui = NekoLib.new("NEKO BF")
    pcall(function() screenGui.Parent = CoreGui end)
    if screenGui.Parent ~= CoreGui then screenGui.Parent = localPlayer.PlayerGui end

    task.spawn(function()
        task.wait(0.6)
        
        local TabInfo = myUI:Tab("å…¬å‘Š / ç‹€æ…‹")
        local MonSec  = TabInfo:Section("è²“å¥´æ§åˆ¶å°")
        local BtnAtk  = MonSec:Button("âš”ï¸ æ”»æ“Šï¼šOFF", function() end)
        local BtnMode = MonSec:Button("ğŸ§  æ¨¡å¼ï¼šNone", function() end)
        task.spawn(function()
            while task.wait(0.5) do
                pcall(function()
                    BtnAtk.Text = "âš”ï¸ æ”»æ“Šï¼š" .. (_G.NekoAttack and "ğŸŸ¢ é‹è¡Œä¸­" or "ğŸ”´ å·²é—œé–‰")
                    local m = (_G.Settings.Mode == "Mob" and "è‡ªå‹•æ‰“æ€ª") or (_G.Settings.Mode == "All" and "å…¨æ®ºæ¨¡å¼") or "ä¼‘æ¯ä¸­"
                    BtnMode.Text = "ğŸ§  æ¨¡å¼ï¼š" .. m
                end)
            end
        end)

        local TabFight = myUI:Tab("æˆ°é¬¥ç³»çµ±")
        local F_Core = TabFight:Section("æ ¸å¿ƒæ”¶å‰²ä¸­å¿ƒ")
        F_Core:Toggle("å•Ÿå‹•ç¥åˆ€é€£æ“Š (FastAttack)", function(s) _G.NekoAttack = s end)
        F_Core:Toggle("é–‹å•Ÿè²“æŠ“æ‹‰æ€ª (Pull)", function(s) _G.Settings.PullEnemies = s end)
        F_Core:Toggle("è‡ªå‹•è¦ºé†’ V4 (å·²ä¿®)", function(s) 
            _G.AutoV4 = s 
            if s then
                game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "NEKO V4",
                    Text = "è‡ªå‹•V4å·²å•Ÿå‹•ï¼èƒ½é‡æ¢æœƒè‡ªå‹•å¡«æ»¿å–µ~",
                    Duration = 5
                })
            end
        end)
        F_Core:Button("ğŸ§  æ¨¡å¼ï¼šè‡ªå‹•æ‰“æ€ª (Mob)", function() _G.Settings.Mode = "Mob"; _G.NekoAttack = true end)
        F_Core:Button("ğŸ”¥ æ¨¡å¼ï¼šå…¨æ®ºæ¨¡å¼ (All)", function() _G.Settings.Mode = "All"; _G.NekoAttack = true end)
        F_Core:Button("ğŸ›‘ åœæ­¢æˆ°é¬¥", function() _G.Settings.Mode = "None"; _G.NekoAttack = false end)

        -- å…¶ä»– Tab ä¿æŒåŸæ¨£ï¼ˆç’°å¢ƒã€ç§»å‹•ã€æœå¯¦ï¼‰ï¼Œé€™è£¡çœç•¥ä»¥å…å¤ªé•·ï¼Œä½ å¯ä»¥ç›´æ¥å¾ä¹‹å‰è²¼çš„è¤‡è£½è²¼ä¸Š
        -- ... (TabEnv, TabMove, TabFruit å…¨éƒ¨è²¼ä¸Šä½ çš„åŸç¢¼)

        -- æ‡¸æµ®æŒ‰éˆ•
        local MiniBtn = Instance.new("TextButton", screenGui)
        MiniBtn.Name = "NekoMainBtn"
        MiniBtn.Size = UDim2.new(0, 65, 0, 65)
        MiniBtn.Position = UDim2.new(0, 20, 0.5, -32)
        MiniBtn.Text = "ğŸ¾"
        MiniBtn.TextSize = 30
        MiniBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
        MiniBtn.TextColor3 = Color3.fromRGB(255, 120, 180)
        Instance.new("UICorner", MiniBtn).CornerRadius = UDim.new(1, 0)
        local Stroke = Instance.new("UIStroke", MiniBtn)
        Stroke.Color = Color3.fromRGB(255, 120, 180)
        Stroke.Thickness = 2
        myUI:AddDrag(MiniBtn)
        MiniBtn.MouseButton1Click:Connect(function() myUI:Toggle() end)

        -- å¼·åˆ¶åˆ·æ–°
        task.delay(1.0, function()
            for _, page in pairs(myUI.Pages:GetChildren()) do
                if page:IsA("ScrollingFrame") then
                    local layout = page:FindFirstChild("UIListLayout")
                    if layout then
                        page.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 20)
                    end
                end
            end
            print("é é¢å·²å¼·åˆ¶åˆ·æ–°ï¼")
        end)
    end)
else
    print("è¼‰å…¥ library å¤±æ•—ï¼è«‹æª¢æŸ¥ GitHub é€£çµæˆ–ç¶²è·¯")
end

-- æˆ°é¬¥èˆ‡è·³èºé‚è¼¯ (åŸæ¨£)
task.spawn(function()
    local RA = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterAttack")
    local RH = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterHit")
    while task.wait() do
        if _G.NekoAttack then
            pcall(function()
                local ts = {}
                local function find(f)
                    for _, e in pairs(f:GetChildren()) do
                        if e:FindFirstChild("Humanoid") and e.Humanoid.Health > 0 then
                            local p = e:FindFirstChild("HumanoidRootPart") or e.PrimaryPart
                            if p and localPlayer:DistanceFromCharacter(p.Position) < _G.Settings.AtkRange then
                                table.insert(ts, {e, p})
                            end
                        end
                    end
                end
                if _G.Settings.Mode == "All" then find(workspace.Enemies); find(workspace.Characters)
                elseif _G.Settings.Mode == "Mob" then find(workspace.Enemies) end
                if #ts > 0 then RA:FireServer(_G.Settings.ClickDelay); RH:FireServer(ts[1][2], ts) end
            end)
        end
        task.wait(_G.Settings.ClickDelay)
    end
end)

UserInputService.JumpRequest:Connect(function()
    local hum = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Humanoid")
    if hum and (_G.Settings.InfJump or _G.Settings.SuperJumpEnabled) then
        if _G.Settings.SuperJumpEnabled then hum.JumpPower = _G.Settings.SuperJumpHeight end
        hum:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

print("NEKO PROJECT V3 è¼‰å…¥å®Œæˆï¼å¦‚æœ UI é‚„æ˜¯ç©ºç™½ï¼Œè«‹æª¢æŸ¥ console æ˜¯å¦æœ‰ 'è¼‰å…¥ library å¤±æ•—'")
