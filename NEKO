local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local localPlayer = Players.LocalPlayer

if getgenv().NEKO_RUNNING then return end
getgenv().NEKO_RUNNING = true

_G.Settings = {
    ClickDelay    = 0.2,
    AtkRange      = 2500,
    PullEnemies   = false,
    Mode          = "None",
    FOV           = 120,
    MaxZoom       = 1000,
    CatSpeedValue = 50,
    SpeedEnabled  = false,
    InfJump       = false,
    SuperJumpEnabled = false,
    SuperJumpHeight = 150,
    StickyEnabled = false,
    StickyTarget  = nil,
    AutoBuyFruit  = false,
    FruitESP      = false
}

_G.NekoRunning = true
_G.NekoAttack  = false
_G.AutoV4      = false
_G.NekoESP     = false
_G.V4Loaded    = false

local Remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")
local function Sea(cmd) pcall(function() Remote:InvokeServer(cmd) end) end

task.spawn(function()
    local Camera = workspace.CurrentCamera
    RunService.RenderStepped:Connect(function()
        if not _G.NekoRunning then return end
        pcall(function()
            Camera.FieldOfView = _G.Settings.FOV
            localPlayer.CameraMaxZoomDistance = _G.Settings.MaxZoom
            localPlayer.CameraMinZoomDistance = 0
            
            local char = localPlayer.Character
            if char and char:FindFirstChild("Humanoid") then
                local hum = char.Humanoid
                if _G.Settings.SpeedEnabled then hum.WalkSpeed = _G.Settings.CatSpeedValue end
            end
        end)
    end)
end)

task.spawn(function()
    while true do
        task.wait(3)
        if _G.AutoV4 and not _G.V4Loaded then
            pcall(function()
                loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/V4"))()
                _G.V4Loaded = true
            end)
        elseif not _G.AutoV4 then
            _G.V4Loaded = false
        end
    end
end)

local function NuclearClean()
    local targets = {"NEKO BF", "NekoUI", "NekoStickyMenu", "NekoMainBtn", "NekoFruitESP"}
    for _, name in ipairs(targets) do
        local obj = CoreGui:FindFirstChild(name) or localPlayer.PlayerGui:FindFirstChild(name)
        if obj then pcall(function() obj:Destroy() end) end
    end
end

NuclearClean()

local FruitFolder = CoreGui:FindFirstChild("NekoFruitESP") or Instance.new("Folder", CoreGui)
FruitFolder.Name = "NekoFruitESP"

local success, UIContent = pcall(function()
    return game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/main/UI")
end)

if success then
    local NekoLib = loadstring(UIContent)()
    local myUI, screenGui = NekoLib.new("ðŸ¾ NEKO BF ðŸ¾")
    pcall(function() screenGui.Parent = CoreGui end)
    if screenGui.Parent ~= CoreGui then screenGui.Parent = localPlayer.PlayerGui end

    task.spawn(function()
        task.wait(0.6)
        
        local TabStatus = myUI:Tab("ðŸ¾ è²“å’ªç‹€æ…‹")
        local StatusSec = TabStatus:Section("å–µå–µç‹€æ…‹é¢æ¿")
        
        local StatusBtns = {}
        StatusBtns.Atk = StatusSec:Button("âš”ï¸ æ”»æ“Šï¼šðŸ”´ ä¼‘æ¯ä¸­", function() end)
        StatusBtns.Mode = StatusSec:Button("ðŸ§  æ¨¡å¼ï¼šä¼‘æ¯ä¸­", function() end)
        StatusBtns.Speed = StatusSec:Button("ðŸ± åŠ é€Ÿï¼šé—œé–‰", function() end)
        StatusBtns.V4 = StatusSec:Button("âœ¨ V4ï¼šé—œé–‰", function() end)
        StatusBtns.ESP = StatusSec:Button("ðŸ‘ï¸ é€è¦–ï¼šé—œé–‰", function() end)
        StatusBtns.Jump = StatusSec:Button("ðŸ¾ è·³èºï¼šé—œé–‰", function() end)
        StatusBtns.Fruit = StatusSec:Button("ðŸŽ æžœå¯¦ï¼šé—œé–‰", function() end)
        
        task.spawn(function()
            while task.wait(2) do
                pcall(function()
                    StatusBtns.Atk.Text = "âš”ï¸ æ”»æ“Šï¼š" .. (_G.NekoAttack and "ðŸŸ¢ å–µå–µç‹‚ç ä¸­" or "ðŸ”´ å–µå–µä¼‘æ¯ä¸­")
                    local modeText = (_G.Settings.Mode == "Mob" and "ðŸ‘¹ è‡ªå‹•æ‰“æ€ª") or (_G.Settings.Mode == "All" and "ðŸ’€ å…¨æ®ºæ¨¡å¼") or "ðŸ˜´ ä¼‘æ¯ä¸­"
                    StatusBtns.Mode.Text = "ðŸ§  æ¨¡å¼ï¼š" .. modeText
                    StatusBtns.Speed.Text = "ðŸ± åŠ é€Ÿï¼š" .. (_G.Settings.SpeedEnabled and "ðŸŸ¢ " .. _G.Settings.CatSpeedValue or "ðŸ”´ é—œé–‰")
                    StatusBtns.V4.Text = "âœ¨ V4ï¼š" .. (_G.AutoV4 and "ðŸŸ¢ å–µå–µè¦ºé†’ä¸­" or "ðŸ”´ é—œé–‰")
                    StatusBtns.ESP.Text = "ðŸ‘ï¸ é€è¦–ï¼š" .. (_G.NekoESP and "ðŸŸ¢ å–µçœ¼å…¨é–‹" or "ðŸ”´ é—œé–‰")
                    local jumpActive = _G.Settings.InfJump or _G.Settings.SuperJumpEnabled
                    StatusBtns.Jump.Text = "ðŸ¾ è·³èºï¼š" .. (jumpActive and "ðŸŸ¢ å–µè·³å•Ÿå‹•" or "ðŸ”´ é—œé–‰")
                    StatusBtns.Fruit.Text = "ðŸŽ æžœå¯¦ï¼š" .. (_G.Settings.FruitESP and "ðŸŸ¢ æžœå¯¦é›·é”" or "ðŸ”´ é—œé–‰")
                end)
            end
        end)

        local TabFight = myUI:Tab("âš”ï¸ æˆ°é¬¥")
        local F_Core = TabFight:Section("æ ¸å¿ƒæ”¶å‰²")
        F_Core:Toggle("ç¥žåˆ€é€£æ“Š", function(s) _G.NekoAttack = s end)
        F_Core:Toggle("è²“æŠ“æ‹‰æ€ª", function(s) _G.Settings.PullEnemies = s end)
        F_Core:Toggle("è‡ªå‹• V4", function(s) 
            _G.AutoV4 = s 
            if s then
                game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "ðŸ¾ NEKO V4",
                    Text = "å–µå–µè‡ªå‹•è¦ºé†’å•Ÿå‹•ï¼èƒ½é‡æ»¿æ»¿å–µï½ž",
                    Duration = 4
                })
            end
        end)
        F_Core:Button("ðŸ‘¹ è‡ªå‹•æ‰“æ€ª", function() _G.Settings.Mode = "Mob"; _G.NekoAttack = true end)
        F_Core:Button("ðŸ’€ å…¨æ®ºæ¨¡å¼", function() _G.Settings.Mode = "All"; _G.NekoAttack = true end)
        F_Core:Button("ðŸ›‘ åœæ­¢æˆ°é¬¥", function() _G.Settings.Mode = "None"; _G.NekoAttack = false end)

        local TabEnv = myUI:Tab("ðŸ‘ï¸ ç’°å¢ƒ")
        local VisualSec = TabEnv:Section("è¦–è¦º")
        VisualSec:Textbox("FOV", "120", function(v)
            local num = tonumber(v)
            if num then _G.Settings.FOV = math.clamp(num, 30, 160) end
        end)
        VisualSec:Textbox("Zoom", "1000", function(v)
            local num = tonumber(v)
            if num then _G.Settings.MaxZoom = math.clamp(num, 1, 10000) end
        end)
        VisualSec:Toggle("è²“è²“é€è¦–", function(s)
            _G.NekoESP = s
            if s and not _G.ESPLoaded then
                _G.ESPLoaded = true
                loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/ESP"))()
            end
        end)
        local EffSec = TabEnv:Section("æ•ˆèƒ½")
        EffSec:Button("FPS å„ªåŒ–", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/FPS"))()
        end)

        local TabMove = myUI:Tab("ðŸ± ç§»å‹•")
        local M1 = TabMove:Section("è²“å’ªç§»å‹•")
        M1:Toggle("è²“å’ªåŠ é€Ÿ", function(s) _G.Settings.SpeedEnabled = s end)
        M1:Textbox("åŠ é€Ÿæ•¸å€¼", "50", function(v)
            local num = tonumber(v)
            if num then _G.Settings.CatSpeedValue = num end
        end)
        M1:Toggle("ç„¡é™è·³èº", function(s) _G.Settings.InfJump = s end)
        M1:Toggle("è¶…ç´šè²“è·³", function(s) _G.Settings.SuperJumpEnabled = s s end)
        M1:Textbox("è·³èºé«˜åº¦", "150", function(v)
            local num = tonumber(v)
            if num then _G.Settings.SuperJumpHeight = num end
        end)
        M1:Button("è²“è²“é£›è¡Œå™¨", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/FLY"))()
        end)

        local TabTP = myUI:Tab("ðŸŒŠ å‚³é€")
        local SeaSec = TabTP:Section("è·¨æµ·å¤§å‚³é€å–µ")
        SeaSec:Button("ðŸï¸ å‰å¾€ï¼šä¸€æµ·", function() Sea("TravelMain") end)
        SeaSec:Button("ðŸ° å‰å¾€ï¼šäºŒæµ·", function() Sea("TravelDressrosa") end)
        SeaSec:Button("ðŸ˜ å‰å¾€ï¼šä¸‰æµ·", function() Sea("TravelZou") end)

        local Sea2Loc = TabTP:Section("ðŸ° äºŒæµ·ç†±é–€é»žå–µ")
        local sea2Locations = {
            ["å¤©éµçš„æˆ¿é–“"] = CFrame.new(-287.37, 305.81, 592.98),
            ["è±ªå®…"] = CFrame.new(2286.93, 15.06, 910.51),
            ["é¬¼èˆ¹è£¡"] = CFrame.new(-6501.06, 83.11, -123.52),
            ["é¬¼èˆ¹å¤–"] = CFrame.new(922.78, 123.96, 32842.40)
        }
        for name, cf in pairs(sea2Locations) do
            Sea2Loc:Button("ðŸ¾ " .. name, function()
                local char = localPlayer.Character
                if char and char:FindFirstChild("HumanoidRootPart") then
                    char.HumanoidRootPart.CFrame = cf
                end
            end)
        end

        local Sea3Loc = TabTP:Section("ðŸ˜ ä¸‰æµ·ç†±é–€é»žå–µ")
        local sea3Locations = {
            ["æµ·æ´‹åŸŽå ¡"] = CFrame.new(-12463.60, 376.26, -7566.08),
            ["æµ·é¾œè±ªå®…"] = CFrame.new(-5060.41, 316.43, -3192.30),
            ["å¸æ³•"] = CFrame.new(-5096.48, 316.43, -3177.91),
            ["ä¹é ­è›‡"] = CFrame.new(-5027.03, 316.43, -3206.07)
        }
        for name, cf in pairs(sea3Locations) do
            Sea3Loc:Button("ðŸ¾ " .. name, function()
                local char = localPlayer.Character
                if char and char:FindFirstChild("HumanoidRootPart") then
                    char.HumanoidRootPart.CFrame = cf
                end
            end)
        end

        local TabFruit = myUI:Tab("ðŸŽ æžœå¯¦")
        local FruitRadar = TabFruit:Section("æžœå¯¦é›·é”")
        FruitRadar:Toggle("æžœå¯¦é€è¦–", function(s) _G.Settings.FruitESP = s end)
        FruitRadar:Button("ðŸš€ ç«‹å³æ’¿æžœ", function()
            local hrp = localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart")
            if not hrp then return end
            for _, v in pairs(Workspace:GetChildren()) do
                if v:IsA("Tool") and (v.Name:find("Fruit") or v:FindFirstChild("Handle")) then
                    hrp.CFrame = (v:FindFirstChild("Handle") or v.PrimaryPart).CFrame + Vector3.new(0, 2, 0)
                end
            end
        end)
        local FruitSec = TabFruit:Section("æŠ½çŽ")
        FruitSec:Toggle("è‡ªå‹•æŠ½æžœ", function(s) _G.Settings.AutoBuyFruit = s end)
        FruitSec:Button("ðŸŽ° æ‰‹å‹•æŠ½çŽ", function() Remote:InvokeServer("Cousin", "Buy") end)

        local MiniBtn = Instance.new("TextButton", screenGui)
        MiniBtn.Name = "NekoMainBtn"
        MiniBtn.Size = UDim2.new(0, 65, 0, 65)
        MiniBtn.Position = UDim2.new(0, 20, 0.5, -32)
        MiniBtn.Text = "ðŸ¾"
        MiniBtn.TextSize = 30
        MiniBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
        MiniBtn.TextColor3 = Color3.fromRGB(255, 120, 180)
        Instance.new("UICorner", MiniBtn).CornerRadius = UDim.new(1, 0)
        local Stroke = Instance.new("UIStroke", MiniBtn)
        Stroke.Color = Color3.fromRGB(255, 120, 180)
        Stroke.Thickness = 2
        myUI:AddDrag(MiniBtn)
        MiniBtn.MouseButton1Click:Connect(function() myUI:Toggle() end)

        task.delay(1.0, function()
            for _, page in pairs(myUI.Pages:GetChildren()) do
                if page:IsA("ScrollingFrame") then
                    local layout = page:FindFirstChild("UIListLayout")
                    if layout then
                        page.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 20)
                    end
                end
            end
        end)
    end)
end

task.spawn(function()
    local RA = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterAttack")
    local RH = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterHit")
    while task.wait(0.05) do
        if _G.NekoAttack then
            pcall(function()
                local ts = {}
                local function find(f)
                    for _, e in pairs(f:GetChildren()) do
                        if #ts > 15 then break end
                        if e:FindFirstChild("Humanoid") and e.Humanoid.Health > 0 then
                            local p = e:FindFirstChild("HumanoidRootPart") or e.PrimaryPart
                            if p and localPlayer:DistanceFromCharacter(p.Position) < _G.Settings.AtkRange then
                                table.insert(ts, {e, p})
                            end
                        end
                    end
                end
                if _G.Settings.Mode == "All" then find(workspace.Enemies); find(workspace.Characters)
                elseif _G.Settings.Mode == "Mob" then find(workspace.Enemies) end
                if #ts > 0 then RA:FireServer(_G.Settings.ClickDelay); RH:FireServer(ts[1][2], ts) end
            end)
        end
    end
end)

UserInputService.JumpRequest:Connect(function()
    local hum = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Humanoid")
    if hum and (_G.Settings.InfJump or _G.Settings.SuperJumpEnabled) then
        if _G.Settings.SuperJumpEnabled then hum.JumpPower = _G.Settings.SuperJumpHeight end
        hum:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)
