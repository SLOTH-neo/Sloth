-- [[ NEKO PROJECT V3 - è‡ªå‹•åµæ¸¬æµ·åŸŸ + å‹•æ…‹å‚³é€æŒ‰éˆ• ]]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")
local localPlayer = Players.LocalPlayer

if getgenv().NEKO_RUNNING then return end
getgenv().NEKO_RUNNING = true

_G.Settings = {
    ClickDelay    = 0.1,
    AtkRange      = 2500,
    PullEnemies   = false,
    Mode          = "None",
    FOV           = 120,
    MaxZoom       = 128,
    CatSpeedValue = 50,
    SpeedEnabled  = false,
    InfJump       = false,
    SuperJumpEnabled = false,
    SuperJumpHeight = 150,
    StickyEnabled = false,
    StickyTarget  = nil,
    AutoBuyFruit  = false,
    FruitESP      = false
}

_G.NekoRunning = true
_G.NekoAttack  = false
_G.AutoV4      = false
_G.NekoESP     = false

local Remote = ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("CommF_")
local function Sea(cmd) pcall(function() Remote:InvokeServer(cmd) end) end

-- åµæ¸¬ç›®å‰æµ·åŸŸ
local function GetCurrentSea()
    local placeId = game.PlaceId
    if placeId == 2753915549 then return 1 end  -- ä¸€æµ·
    if placeId == 4442272183 then return 2 end  -- äºŒæµ·
    if placeId == 7449423635 then return 3 end  -- ä¸‰æµ·
    return 0  -- æœªçŸ¥
end

-- æ ¹æ“šæµ·åŸŸè¿”å›å¯å‚³é€åœ°é»
local function GetSeaTeleports(sea)
    if sea == 1 then
        return {
            {name = "æ¸¯å£", cmd = "TeleportToPort"},
            {name = "å¯å¯è¥¿äºæ‘", cmd = "TeleportToCocoa"},
            {name = "æ©˜å­é®", cmd = "TeleportToOrange"},
        }
    elseif sea == 2 then
        return {
            {name = "å’–å•¡å»³", cmd = "TeleportToCafe"},
            {name = "å†°å‡å³¶", cmd = "TeleportToIce"},
            {name = "æ°´ä¹‹éƒ½", cmd = "TeleportToWater"},
        }
    elseif sea == 3 then
        return {
            {name = "å¤©ç©ºå³¶", cmd = "TeleportToSky"},
            {name = "é­šäººå³¶", cmd = "TeleportToFishman"},
            {name = "è¬åœ‹", cmd = "TeleportToWholeCake"},
            {name = "å’Œä¹‹åœ‹", cmd = "TeleportToWano"},
            {name = "é›ªå±±", cmd = "TeleportToSnow"},
            {name = "æ²™æ¼ ", cmd = "TeleportToDesert"},
            {name = "ç«å±±", cmd = "TeleportToVolcano"},
            {name = "å¢“åœ°", cmd = "TeleportToGraveyard"},
            {name = "ç¥ç§˜å³¶", cmd = "TeleportToMystery"},
        }
    else
        return {}
    end
end

-- æ¸²æŸ“å¾ªç’° + V4 (åŸæ¨£)
task.spawn(function()
    local Camera = workspace.CurrentCamera
    RunService.RenderStepped:Connect(function()
        if not _G.NekoRunning then return end
        pcall(function()
            Camera.FieldOfView = _G.Settings.FOV
            localPlayer.CameraMaxZoomDistance = _G.Settings.MaxZoom
            localPlayer.CameraMinZoomDistance = 0
            
            local char = localPlayer.Character
            if char and char:FindFirstChild("Humanoid") then
                local hum = char.Humanoid
                if _G.Settings.SpeedEnabled then hum.WalkSpeed = _G.Settings.CatSpeedValue end
                if _G.AutoV4 then
                    pcall(function()
                        Remote:InvokeServer("SetRaceV4", true)
                        Remote:InvokeServer("RaceV4", true)
                        if hum:GetAttribute("Awakening") or hum:GetAttribute("V4Awakening") then
                            Remote:InvokeServer("Awakening", true)
                        end
                    end)
                end
            end
        end)
    end)
end)

task.spawn(function()
    while task.wait(1) do
        if _G.AutoV4 then
            pcall(function()
                Remote:InvokeServer("SetRaceV4", true)
                Remote:InvokeServer("RaceV4", true)
            end)
        end
    end
end)

-- æ¸…ç†èˆŠUI
local function NuclearClean()
    local targets = {"NEKO BF", "NekoUI", "NekoStickyMenu", "NekoMainBtn", "NekoFruitESP"}
    for _, name in ipairs(targets) do
        local obj = CoreGui:FindFirstChild(name) or localPlayer.PlayerGui:FindFirstChild(name)
        if obj then pcall(function() obj:Destroy() end) end
    end
end
NuclearClean()
local FruitFolder = CoreGui:FindFirstChild("NekoFruitESP") or Instance.new("Folder", CoreGui)
FruitFolder.Name = "NekoFruitESP"

-- è¼‰å…¥ library
local success, UIContent = pcall(function()
    return game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/main/UI")
end)

if success then
    local NekoLib = loadstring(UIContent)()
    local myUI, screenGui = NekoLib.new("NEKO BF")
    pcall(function() screenGui.Parent = CoreGui end)
    if screenGui.Parent ~= CoreGui then screenGui.Parent = localPlayer.PlayerGui end

    task.spawn(function()
        task.wait(0.6)
        
        -- å…¬å‘Š / ç‹€æ…‹ (åŸæ¨£)
        local TabInfo = myUI:Tab("å…¬å‘Š / ç‹€æ…‹")
        local MonSec  = TabInfo:Section("è²“å¥´æ§åˆ¶å°")
        local BtnAtk  = MonSec:Button("âš”ï¸ æ”»æ“Šï¼šOFF", function() end)
        local BtnMode = MonSec:Button("ğŸ§  æ¨¡å¼ï¼šNone", function() end)
        task.spawn(function()
            while task.wait(0.5) do
                pcall(function()
                    BtnAtk.Text = "âš”ï¸ æ”»æ“Šï¼š" .. (_G.NekoAttack and "ğŸŸ¢ é‹è¡Œä¸­" or "ğŸ”´ å·²é—œé–‰")
                    local m = (_G.Settings.Mode == "Mob" and "è‡ªå‹•æ‰“æ€ª") or (_G.Settings.Mode == "All" and "å…¨æ®ºæ¨¡å¼") or "ä¼‘æ¯ä¸­"
                    BtnMode.Text = "ğŸ§  æ¨¡å¼ï¼š" .. m
                end)
            end
        end)

        -- æˆ°é¬¥ç³»çµ± (åŸæ¨£)
        local TabFight = myUI:Tab("æˆ°é¬¥ç³»çµ±")
        local F_Core = TabFight:Section("æ ¸å¿ƒæ”¶å‰²ä¸­å¿ƒ")
        F_Core:Toggle("å•Ÿå‹•ç¥åˆ€é€£æ“Š (FastAttack)", function(s) _G.NekoAttack = s end)
        F_Core:Toggle("é–‹å•Ÿè²“æŠ“æ‹‰æ€ª (Pull)", function(s) _G.Settings.PullEnemies = s end)
        F_Core:Toggle("è‡ªå‹•è¦ºé†’ V4 (å·²ä¿®)", function(s) 
            _G.AutoV4 = s 
            if s then
                game:GetService("StarterGui"):SetCore("SendNotification", {
                    Title = "NEKO V4",
                    Text = "è‡ªå‹•V4å·²å•Ÿå‹•ï¼èƒ½é‡æ¢æœƒè‡ªå‹•å¡«æ»¿å–µ~",
                    Duration = 5
                })
            end
        end)
        F_Core:Button("ğŸ§  æ¨¡å¼ï¼šè‡ªå‹•æ‰“æ€ª (Mob)", function() _G.Settings.Mode = "Mob"; _G.NekoAttack = true end)
        F_Core:Button("ğŸ”¥ æ¨¡å¼ï¼šå…¨æ®ºæ¨¡å¼ (All)", function() _G.Settings.Mode = "All"; _G.NekoAttack = true end)
        F_Core:Button("ğŸ›‘ åœæ­¢æˆ°é¬¥", function() _G.Settings.Mode = "None"; _G.NekoAttack = false end)

        -- ç’°å¢ƒå„ªåŒ– (åŸæ¨£)
        local TabEnv = myUI:Tab("ç’°å¢ƒå„ªåŒ–")
        local VisualSec = TabEnv:Section("è¦–è¦ºå¢å¼·")
        VisualSec:Textbox("è¦–é‡è§’åº¦ (FOV)", "80", function(v)
            local num = tonumber(v)
            if num then _G.Settings.FOV = math.clamp(num, 30, 160) end
        end)
        VisualSec:Textbox("é¡é ­è·é›¢ (Zoom)", "128", function(v)
            local num = tonumber(v)
            if num then _G.Settings.MaxZoom = math.clamp(num, 1, 10000) end
        end)
        VisualSec:Toggle("é–‹å•Ÿè²“è²“é€è¦– (ESP)", function(s)
            _G.NekoESP = s
            if s and not _G.ESPLoaded then
                _G.ESPLoaded = true
                loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/ESP"))()
            end
        end)
        local EffSec = TabEnv:Section("æ•ˆèƒ½")
        EffSec:Button("FPS æ¥µè‡´å„ªåŒ–", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/FPS"))()
        end)

        -- ç§»å‹• Tab (åŸæ¨£)
        local TabMove = myUI:Tab("ç§»å‹•")
        local M1 = TabMove:Section("è§’è‰²ç§»å‹•")
        M1:Toggle("é–‹å•Ÿç§»å‹•åŠ é€Ÿ", function(s) _G.Settings.SpeedEnabled = s end)
        M1:Textbox("åŠ é€Ÿæ•¸å€¼", "50", function(v)
            local num = tonumber(v)
            if num then _G.Settings.CatSpeedValue = num end
        end)
        M1:Toggle("é–‹å•Ÿç„¡é™è·³èº", function(s) _G.Settings.InfJump = s end)
        M1:Toggle("è¶…ç´šè·³èº", function(s) _G.Settings.SuperJumpEnabled = s end)
        M1:Textbox("è¶…ç´šè·³é«˜åº¦", "150", function(v)
            local num = tonumber(v)
            if num then _G.Settings.SuperJumpHeight = num end
        end)
        M1:Button("å¬å–šè²“è²“é£›è¡Œå™¨", function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/SLOTH-neo/Sloth/refs/heads/main/FLY"))()
        end)

        -- å‚³é€ Tab (å‹•æ…‹åµæ¸¬æµ·åŸŸ + é¡¯ç¤ºç•¶å‰æµ·åŸŸå¯å»åœ°é»)
        local TabTP = myUI:Tab("å‚³é€")
        local TPSection = TabTP:Section("è·¨æµ·å‚³é€")
        local StatusLabel = TPSection:Textbox("ç›®å‰æµ·åŸŸ", "åµæ¸¬ä¸­...", function() end)  -- é¡¯ç¤ºç‹€æ…‹

        -- åŸºæœ¬è·¨æµ·
        TPSection:Button("å‰å¾€ï¼šä¸€æµ·", function() Sea("TravelMain") end)
        TPSection:Button("å‰å¾€ï¼šäºŒæµ·", function() Sea("TravelDressrosa") end)
        TPSection:Button("å‰å¾€ï¼šä¸‰æµ·", function() Sea("TravelZou") end)

        -- åµæ¸¬æµ·åŸŸä¸¦æ›´æ–°å¯å‚³é€æŒ‰éˆ•
        local function UpdateSeaTeleports()
            local sea = GetCurrentSea()
            local seaName = sea == 1 and "ä¸€æµ·" or sea == 2 and "äºŒæµ·" or sea == 3 and "ä¸‰æµ·" or "æœªçŸ¥"
            StatusLabel.Text = "ç›®å‰æµ·åŸŸï¼š" .. seaName

            -- å‹•æ…‹æ¸…é™¤èˆŠæŒ‰éˆ•ï¼ˆé¿å…é‡è¤‡ï¼‰
            for _, child in pairs(TPSection.Box:GetChildren()) do
                if child:IsA("TextButton") and child.Text:find("å‰å¾€") then
                    child:Destroy()
                end
            end

            -- æ ¹æ“šæµ·åŸŸåŠ æŒ‰éˆ•
            local teleports = GetSeaTeleports(sea)
            for _, tp in ipairs(teleports) do
                TPSection:Button("å‰å¾€ï¼š" .. tp.name, function() Sea(tp.cmd) end)
            end
        end

        -- åˆå§‹åµæ¸¬
        UpdateSeaTeleports()

        -- æ¯ 10 ç§’åµæ¸¬ä¸€æ¬¡ï¼ˆé˜²æ›æµ·æ²’æ›´æ–°ï¼‰
        task.spawn(function()
            while true do
                task.wait(10)
                UpdateSeaTeleports()
            end
        end)

        -- æœå¯¦ç³»çµ± (åŸæ¨£)
        local TabFruit = myUI:Tab("æœå¯¦ç³»çµ±")
        local FruitRadar = TabFruit:Section("åœ°åœ–æœå¯¦åµæ¸¬")
        FruitRadar:Toggle("é–‹å•Ÿæœå¯¦é€è¦–", function(s) _G.Settings.FruitESP = s end)
        FruitRadar:Button("ğŸš€ ç«‹å³å‚³é€æ‹¾å–", function()
            local hrp = localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart")
            if not hrp then return end
            for _, v in pairs(Workspace:GetChildren()) do
                if v:IsA("Tool") and (v.Name:find("Fruit") or v:FindFirstChild("Handle")) then
                    hrp.CFrame = (v:FindFirstChild("Handle") or v.PrimaryPart).CFrame + Vector3.new(0, 2, 0)
                end
            end
        end)
        local FruitSec = TabFruit:Section("è‡ªå‹•èˆ‡æŠ½ç")
        FruitSec:Toggle("è‡ªå‹•æŠ½æœå¯¦", function(s) _G.Settings.AutoBuyFruit = s end)
        FruitSec:Button("ğŸ° æ‰‹å‹•æŠ½ç", function() Remote:InvokeServer("Cousin", "Buy") end)

        -- æ‡¸æµ®æŒ‰éˆ• (åŸæ¨£)
        local MiniBtn = Instance.new("TextButton", screenGui)
        MiniBtn.Name = "NekoMainBtn"
        MiniBtn.Size = UDim2.new(0, 65, 0, 65)
        MiniBtn.Position = UDim2.new(0, 20, 0.5, -32)
        MiniBtn.Text = "ğŸ¾"
        MiniBtn.TextSize = 30
        MiniBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
        MiniBtn.TextColor3 = Color3.fromRGB(255, 120, 180)
        Instance.new("UICorner", MiniBtn).CornerRadius = UDim.new(1, 0)
        local Stroke = Instance.new("UIStroke", MiniBtn)
        Stroke.Color = Color3.fromRGB(255, 120, 180)
        Stroke.Thickness = 2
        myUI:AddDrag(MiniBtn)
        MiniBtn.MouseButton1Click:Connect(function() myUI:Toggle() end)

        -- å¼·åˆ¶åˆ·æ–° (åŸæ¨£)
        task.delay(1.0, function()
            for _, page in pairs(myUI.Pages:GetChildren()) do
                if page:IsA("ScrollingFrame") then
                    local layout = page:FindFirstChild("UIListLayout")
                    if layout then
                        page.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 20)
                    end
                end
            end
            print("é é¢å·²å¼·åˆ¶åˆ·æ–°å®Œæˆï¼")
        end)
    end)
else
    print("è¼‰å…¥ library å¤±æ•—ï¼è«‹æª¢æŸ¥é€£çµæˆ–ç¶²è·¯")
end

-- æˆ°é¬¥é‚è¼¯ (åŸæ¨£)
task.spawn(function()
    local RA = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterAttack")
    local RH = ReplicatedStorage.Modules.Net:WaitForChild("RE/RegisterHit")
    while task.wait() do
        if _G.NekoAttack then
            pcall(function()
                local ts = {}
                local function find(f)
                    for _, e in pairs(f:GetChildren()) do
                        if e:FindFirstChild("Humanoid") and e.Humanoid.Health > 0 then
                            local p = e:FindFirstChild("HumanoidRootPart") or e.PrimaryPart
                            if p and localPlayer:DistanceFromCharacter(p.Position) < _G.Settings.AtkRange then
                                table.insert(ts, {e, p})
                            end
                        end
                    end
                end
                if _G.Settings.Mode == "All" then find(workspace.Enemies); find(workspace.Characters)
                elseif _G.Settings.Mode == "Mob" then find(workspace.Enemies) end
                if #ts > 0 then RA:FireServer(_G.Settings.ClickDelay); RH:FireServer(ts[1][2], ts) end
            end)
        end
        task.wait(_G.Settings.ClickDelay)
    end
end)

UserInputService.JumpRequest:Connect(function()
    local hum = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Humanoid")
    if hum and (_G.Settings.InfJump or _G.Settings.SuperJumpEnabled) then
        if _G.Settings.SuperJumpEnabled then hum.JumpPower = _G.Settings.SuperJumpHeight end
        hum:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

print("NEKO PROJECT V3 è¼‰å…¥å®Œæˆï¼æ–°å¢è‡ªå‹•åµæ¸¬æµ·åŸŸ + å‹•æ…‹å‚³é€æŒ‰éˆ•")
