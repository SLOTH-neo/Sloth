-- [[ NEKO SENSE - å½±ä¹‹çœ¼é€è¦– (å·²å‡ç´šç‰ˆ) ]]
if _G.ESPStarted then _G.ESPStarted = false; task.wait(0.3) end
_G.ESPStarted = true

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- å»ºç«‹/æŠ“å–å®¹å™¨
local Folder = CoreGui:FindFirstChild("NekoESP") or Instance.new("Folder", CoreGui)
Folder.Name = "NekoESP"

-- ç©å®¶é›¢é–‹ç›£è½
local removeConn = Players.PlayerRemoving:Connect(function(p)
    if Folder:FindFirstChild(p.Name) then
        Folder[p.Name]:Destroy()
    end
end)

task.spawn(function()
    while _G.ESPStarted do
        for _, p in ipairs(Players:GetPlayers()) do
            pcall(function() 
                if p ~= LocalPlayer then
                    local char = p.Character
                    local hrp = char and char:FindFirstChild("HumanoidRootPart")
                    local hum = char and char:FindFirstChildOfClass("Humanoid")
                    
                    if _G.NekoESP and char and hrp and hum and hum.Health > 0 then
                        local lroot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                        local dist = lroot and (hrp.Position - lroot.Position).Magnitude or 0
                        
                        -- 100è¬ç±³è¶…é è·éæ¿¾
                        if dist <= 1000000 then
                            local bb = Folder:FindFirstChild(p.Name) or Instance.new("BillboardGui", Folder)
                            bb.Name = p.Name; bb.Adornee = hrp; bb.AlwaysOnTop = true
                            bb.Size = UDim2.new(0, 180, 0, 70); bb.Enabled = true
                            
                            -- è¡€é‡ç™¾åˆ†æ¯”èˆ‡é¡è‰²
                            local hpP = math.clamp(hum.Health / hum.MaxHealth, 0, 1)
                            local hpC = Color3.fromRGB(100, 255, 100):Lerp(Color3.fromRGB(255, 50, 50), 1 - hpP)
                            
                            -- [A] åå­—æ¨™ç±¤ (åå­—é¡è‰² + è·é›¢é¡è‰²)
                            local nameL = bb:FindFirstChild("NameL") or Instance.new("TextLabel", bb)
                            nameL.Name = "NameL"; nameL.Parent = bb
                            nameL.Size = UDim2.new(1, 0, 0.4, 0); nameL.BackgroundTransparency = 1
                            nameL.Font = Enum.Font.GothamBold; nameL.TextSize = 14
                            nameL.TextStrokeTransparency = 0.4; nameL.TextStrokeColor3 = Color3.new(0,0,0)
                            
                            local nameColor = Color3.fromRGB(255, 255, 255) -- é è¨­ç™½
                            local distColor = dist < 200 and Color3.fromRGB(255, 50, 50) or Color3.fromRGB(100, 255, 100)
                            nameL.Text = string.format("ğŸ¾ %s [%dm]", p.Name, math.floor(dist))
                            nameL.TextColor3 = distColor
                            
                            -- æ­¦å™¨/æœå¯¦åç¨±é¡¯ç¤º
                            local tool = char:FindFirstChildOfClass("Tool")
                            local toolName = tool and tool.Name or "ç„¡æ­¦å™¨"
                            if toolName:find("Fruit") then toolName = "æœå¯¦: " .. toolName end
                            if dist < 800 then
                                nameL.Text = nameL.Text .. "\n" .. toolName
                            end
                            
                            -- è¿‘è·é›¢æ‰é¡¯ç¤ºç´°ç¯€
                            local isClose = dist < 800
                            
                            -- è¡€æ¢èƒŒæ™¯ + è¡€é‡æ•¸å­— + ç™¾åˆ†æ¯”
                            local barBg = bb:FindFirstChild("BarBg") or Instance.new("Frame", bb)
                            barBg.Name = "BarBg"; barBg.Parent = bb
                            barBg.Size = UDim2.new(0.6, 0, 0, 4); barBg.Position = UDim2.new(0.2, 0, 0.55, 0)
                            barBg.BackgroundColor3 = Color3.new(0, 0, 0); barBg.BorderSizePixel = 0
                            barBg.Visible = isClose
                            
                            local bar = barBg:FindFirstChild("Bar") or Instance.new("Frame", barBg)
                            bar.Name = "Bar"; bar.Parent = barBg; bar.BorderSizePixel = 0
                            bar.Size = UDim2.new(hpP, 0, 1, 0); bar.BackgroundColor3 = hpC
                            
                            if isClose then
                                local hpLabel = bb:FindFirstChild("HPLabel") or Instance.new("TextLabel", bb)
                                hpLabel.Name = "HPLabel"; hpLabel.Parent = bb
                                hpLabel.Size = UDim2.new(0.6, 0, 0.3, 0)
                                hpLabel.Position = UDim2.new(0.2, 0, 0.25, 0)
                                hpLabel.BackgroundTransparency = 1
                                hpLabel.Font = Enum.Font.GothamBold
                                hpLabel.TextSize = 12
                                hpLabel.TextColor3 = hpC
                                hpLabel.TextStrokeTransparency = 0.6
                                hpLabel.Text = string.format("%.0f%%", hpP * 100)
                            end
                            
                            -- Highlight é€è¦–ï¼ˆè¿‘è·é›¢æ‰äº®ï¼‰
                            local highlight = char:FindFirstChild("NekoHighlight") or Instance.new("Highlight", char)
                            highlight.Name = "NekoHighlight"; highlight.Adornee = char
                            highlight.FillColor = hpC; highlight.FillTransparency = 0.8
                            highlight.OutlineTransparency = 0.2
                            highlight.Enabled = isClose
                        end
                    else
                        if Folder:FindFirstChild(p.Name) then Folder[p.Name].Enabled = false end
                        if char and char:FindFirstChild("NekoHighlight") then char.NekoHighlight.Enabled = false end
                    end
                end
            end)
        end
        
        -- æ¸…ç†æ®˜ç•™
        for _, gui in ipairs(Folder:GetChildren()) do
            if not Players:FindFirstChild(gui.Name) then
                gui:Destroy()
            end
        end
        
        task.wait(0.4) -- æƒæé »ç‡å†å„ªåŒ–
    end
    
    if removeConn then removeConn:Disconnect() end
    Folder:ClearAllChildren()
    
    -- é—œé–‰é€šçŸ¥
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "NEKO SENSE",
        Text = "å½±ä¹‹çœ¼å·²é—œé–‰å–µï½",
        Duration = 4
    })
end)

-- é–‹å•Ÿé€šçŸ¥
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "NEKO SENSE",
    Text = "é€è¦–å·²é–‹å•Ÿ",
    Duration = 4
})

print("é€è¦–åŠŸèƒ½å·²å•Ÿå‹•")
