--[[UI]]--

-- [[ Neko_PinkCyber_UI - AR HUD Edition with Collapsible Sections ]]
local library = {}

local services = setmetatable({}, {
    __index = function(_, k) 
        return game:GetService(k) 
    end
})

local ts = services.TweenService

local function Tween(obj, info, prop)
    local t = ts:Create(obj, TweenInfo.new(unpack(info)), prop)
    t:Play()
    return t
end

-- [[ üå∏ Ê´ªËä±ÈúìËôπÈÖçËâ≤ÊñπÊ°à ]]
local C = {
    Accent  = Color3.fromRGB(255, 105, 180), 
    MainBG  = Color3.fromRGB(15, 10, 15),    
    SideBG  = Color3.fromRGB(10, 5, 10),     
    BtnBG   = Color3.fromRGB(35, 25, 35),    
    Text    = Color3.fromRGB(220, 180, 200), 
    TextDim = Color3.fromRGB(110, 80, 95),   
    TextHi  = Color3.fromRGB(255, 255, 255), 
    Stroke  = Color3.fromRGB(255, 150, 200), 
    DotOff  = Color3.fromRGB(50, 40, 45),    
}

function library.new(name)
    local sg = Instance.new("ScreenGui", services.CoreGui)
    sg.Name = "Neko_PinkCyber_UI"
    sg.ResetOnSpawn = false
    sg.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    -- ‰∏ªË¶ñÁ™ó (ÈÄèÊòé AR HUD)
    local Main = Instance.new("Frame", sg)
    Main.Size = UDim2.new(0, 460, 0, 310)
    Main.Position = UDim2.new(0.5, -230, 0.5, -155)
    Main.BackgroundColor3 = C.MainBG
    Main.BackgroundTransparency = 1
    Main.BorderSizePixel = 0
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 14)

    local MainStroke = Instance.new("UIStroke", Main)
    MainStroke.Thickness = 1.2
    MainStroke.Color = C.Stroke
    MainStroke.Transparency = 0.6
    MainStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

    -- ÂÅ¥ÈÇäÂ∞éËà™
    local Side = Instance.new("Frame", Main)
    Side.Size = UDim2.new(0, 135, 1, 0)
    Side.BackgroundColor3 = C.SideBG
    Side.BackgroundTransparency = 1
    Side.BorderSizePixel = 0
    Instance.new("UICorner", Side).CornerRadius = UDim.new(0, 14)

    local Title = Instance.new("TextLabel", Side)
    Title.Size = UDim2.new(1, 0, 0, 50)
    Title.Text = "üå∏ " .. name:upper()
    Title.TextColor3 = C.Accent
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 16
    Title.BackgroundTransparency = 1

    local TabContainer = Instance.new("ScrollingFrame", Side)
    TabContainer.Size = UDim2.new(1, -12, 1, -60)
    TabContainer.Position = UDim2.new(0, 6, 0, 50)
    TabContainer.BackgroundTransparency = 1
    TabContainer.ScrollBarThickness = 0
    TabContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
    
    local tl = Instance.new("UIListLayout", TabContainer)
    tl.Padding = UDim.new(0, 5)
    tl.SortOrder = Enum.SortOrder.LayoutOrder
    tl:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        TabContainer.CanvasSize = UDim2.new(0, 0, 0, tl.AbsoluteContentSize.Y)
    end)

    local Pages = Instance.new("Frame", Main)
    Pages.Size = UDim2.new(1, -150, 1, -20)
    Pages.Position = UDim2.new(0, 140, 0, 10)
    Pages.BackgroundTransparency = 1

    local window = {current = nil}

    function window:Toggle()
        Main.Visible = not Main.Visible
    end

    function window:Tab(name)
        local Page = Instance.new("ScrollingFrame", Pages)
        Page.Size = UDim2.new(1, 0, 1, 0)
        Page.ScrollBarThickness = 0
        Page.BackgroundTransparency = 1
        Page.Visible = false
        
        local pl = Instance.new("UIListLayout", Page)
        pl.Padding = UDim.new(0, 10)
        pl.SortOrder = Enum.SortOrder.LayoutOrder
        pl:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Page.CanvasSize = UDim2.new(0, 0, 0, pl.AbsoluteContentSize.Y + 10)
        end)

        local Btn = Instance.new("TextButton", TabContainer)
        Btn.Size = UDim2.new(1, 0, 0, 36)
        Btn.BackgroundColor3 = C.BtnBG
        Btn.BackgroundTransparency = 1
        Btn.Text = "      " .. name
        Btn.TextColor3 = C.TextDim
        Btn.Font = Enum.Font.GothamMedium
        Btn.TextSize = 12
        Btn.TextXAlignment = Enum.TextXAlignment.Left
        Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 8)

        local Indicator = Instance.new("Frame", Btn)
        Indicator.Size = UDim2.new(0, 3, 0, 0)
        Indicator.Position = UDim2.new(0, 8, 0.5, 0)
        Indicator.AnchorPoint = Vector2.new(0, 0.5)
        Indicator.BackgroundColor3 = C.Accent
        Indicator.BorderSizePixel = 0
        Instance.new("UICorner", Indicator)

        Btn.MouseButton1Click:Connect(function()
            if window.current then
                window.current.Page.Visible = false
                Tween(window.current.Indicator, {0.2}, {Size = UDim2.new(0, 3, 0, 0)})
                Tween(window.current.Btn, {0.2}, {BackgroundTransparency = 1, TextColor3 = C.TextDim})
            end
            Page.Visible = true
            Tween(Indicator, {0.3, Enum.EasingStyle.Back}, {Size = UDim2.new(0, 3, 0, 18)})
            Tween(Btn, {0.2}, {BackgroundTransparency = 0.9, TextColor3 = C.TextHi})
            window.current = {Page = Page, Btn = Btn, Indicator = Indicator}
        end)

        if not window.current then
            Page.Visible = true
            Btn.BackgroundTransparency = 0.9
            Btn.TextColor3 = C.TextHi
            Indicator.Size = UDim2.new(0, 3, 0, 18)
            window.current = {Page = Page, Btn = Btn, Indicator = Indicator}
        end

        local tab = {}

        function tab:Section(txt, opened)
            local Sec = Instance.new("Frame", Page)
            Sec.Size = UDim2.new(0.98, 0, 0, 32)
            Sec.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            Sec.BackgroundTransparency = 0.98
            Instance.new("UICorner", Sec).CornerRadius = UDim.new(0, 10)
            
            local SecStroke = Instance.new("UIStroke", Sec)
            SecStroke.Color = C.Stroke
            SecStroke.Transparency = 0.94
            SecStroke.Thickness = 1

            -- Ê®ôÈ°åË°å (ÂèØÈªûÊìäÊî∂Âêà)
            local Header = Instance.new("TextButton", Sec)
            Header.Size = UDim2.new(1, 0, 0, 32)
            Header.BackgroundTransparency = 1
            Header.Text = ""
            Header.AutoButtonColor = false

            local Arrow = Instance.new("TextLabel", Header)
            Arrow.Size = UDim2.new(0, 20, 0, 20)
            Arrow.Position = UDim2.new(0, 8, 0.5, -10)
            Arrow.BackgroundTransparency = 1
            Arrow.Text = "‚ñ∂"
            Arrow.TextColor3 = C.Accent
            Arrow.Font = Enum.Font.GothamBold
            Arrow.TextSize = 14

            local T = Instance.new("TextLabel", Header)
            T.Size = UDim2.new(1, -40, 1, 0)
            T.Position = UDim2.new(0, 35, 0, 0)
            T.Text = txt:upper()
            T.TextColor3 = C.Accent
            T.Font = Enum.Font.GothamBold
            T.TextSize = 10
            T.TextXAlignment = Enum.TextXAlignment.Left
            T.BackgroundTransparency = 1

            local Box = Instance.new("Frame", Sec)
            Box.Size = UDim2.new(1, 0, 0, 0)
            Box.Position = UDim2.new(0, 0, 0, 32)
            Box.BackgroundTransparency = 1
            Box.ClipsDescendants = true  -- Êî∂ÂêàÊôÇÈö±ËóèÂÖßÂÆπ
            
            local bl = Instance.new("UIListLayout", Box)
            bl.Padding = UDim.new(0, 6)
            bl.HorizontalAlignment = Enum.HorizontalAlignment.Center
            bl:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                if Box.Visible then
                    Sec.Size = UDim2.new(0.98, 0, 0, bl.AbsoluteContentSize.Y + 38)
                end
            end)

            -- Êî∂ÂêàÈÇèËºØ
            local isOpen = opened ~= false  -- È†êË®≠ÈñãÂïüÔºåÈô§ÈùûÊåáÂÆöfalse
            Box.Visible = isOpen
            Arrow.Text = isOpen and "‚ñº" or "‚ñ∂"
            if isOpen then
                Sec.Size = UDim2.new(0.98, 0, 0, 0)  -- ÂÖàË®≠0Ôºå‰πãÂæåËá™ÂãïË™øÊï¥
            end

            Header.MouseButton1Click:Connect(function()
                isOpen = not isOpen
                Arrow.Text = isOpen and "‚ñº" or "‚ñ∂"
                
                if isOpen then
                    -- Â±ïÈñãÂãïÁï´
                    Tween(Sec, {0.3, Enum.EasingStyle.Back}, {Size = UDim2.new(0.98, 0, 0, bl.AbsoluteContentSize.Y + 38)})
                    Box.Visible = true
                    Tween(Arrow, {0.2}, {Rotation = 0})
                else
                    -- Êî∂ÂêàÂãïÁï´
                    Tween(Sec, {0.3, Enum.EasingStyle.Back}, {Size = UDim2.new(0.98, 0, 0, 32)})
                    task.delay(0.3, function() Box.Visible = false end)
                    Tween(Arrow, {0.2}, {Rotation = -90})  -- ÁÆ≠È†≠ËΩâÂêëÊõ¥ÊòéÈ°Ø
                end
                
                -- ËºïÂæÆÁôºÂÖâÊïàÊûú
                Tween(SecStroke, {0.2}, {Transparency = isOpen and 0.7 or 0.94})
            end)

            local e = {}

            function e:Button(t, cb)
                local b = Instance.new("TextButton", Box)
                b.Size = UDim2.new(0.94, 0, 0, 32)
                b.BackgroundColor3 = C.BtnBG
                b.Text = t
                b.TextColor3 = C.Text
                b.Font = Enum.Font.GothamMedium
                b.TextSize = 12
                Instance.new("UICorner", b).CornerRadius = UDim.new(0, 8)
                
                b.MouseButton1Down:Connect(function()
                    Tween(b, {0.1}, {Size = UDim2.new(0.9, 0, 0, 28)})
                end)
                b.MouseButton1Up:Connect(function()
                    Tween(b, {0.2, Enum.EasingStyle.Back}, {Size = UDim2.new(0.94, 0, 0, 32)})
                    cb()
                end)
                return b 
            end

            -- Toggle Âíå Textbox ‰øùÊåÅÂéüÊ®£ÔºåÂ°ûÈÄ≤ Box
            function e:Toggle(t, cb)
                -- ... (Âéü Toggle ‰ª£Á¢º‰∏çËÆäÔºåÁõ¥Êé•Ë≤º‰∏ä)
                local b = Instance.new("TextButton", Box)
                b.Size = UDim2.new(0.94, 0, 0, 32)
                b.BackgroundColor3 = C.BtnBG
                b.Text = "  " .. t
                b.TextColor3 = C.Text
                b.Font = Enum.Font.GothamMedium
                b.TextSize = 12
                b.TextXAlignment = Enum.TextXAlignment.Left
                Instance.new("UICorner", b).CornerRadius = UDim.new(0, 8)
                
                local d = Instance.new("Frame", b)
                d.Size = UDim2.new(0, 24, 0, 13)
                d.Position = UDim2.new(1, -32, 0.5, -6.5)
                d.BackgroundColor3 = C.DotOff
                Instance.new("UICorner", d).CornerRadius = UDim.new(1, 0)
                
                local dot = Instance.new("Frame", d)
                dot.Size = UDim2.new(0, 9, 0, 9)
                dot.Position = UDim2.new(0, 2, 0.5, -4.5)
                dot.BackgroundColor3 = Color3.new(1, 1, 1)
                Instance.new("UICorner", dot).CornerRadius = UDim.new(1, 0)
                
                local s = false
                b.MouseButton1Click:Connect(function()
                    s = not s
                    Tween(d, {0.2}, {BackgroundColor3 = s and C.Accent or C.DotOff})
                    Tween(dot, {0.2, Enum.EasingStyle.Back}, {Position = s and UDim2.new(1, -11, 0.5, -4.5) or UDim2.new(0, 2, 0.5, -4.5)})
                    cb(s)
                end)
                return b
            end

            function e:Textbox(p, d, cb)
                -- ... (Âéü Textbox ‰ª£Á¢º‰∏çËÆä)
                local b = Instance.new("TextBox", Box)
                b.Size = UDim2.new(0.94, 0, 0, 32)
                b.BackgroundColor3 = Color3.fromRGB(20, 15, 20)
                b.Text = d or ""
                b.PlaceholderText = p
                b.TextColor3 = C.TextHi
                b.PlaceholderColor3 = C.TextDim
                b.Font = Enum.Font.GothamMedium
                b.TextSize = 12
                Instance.new("UICorner", b).CornerRadius = UDim.new(0, 8)
                
                local tStroke = Instance.new("UIStroke", b)
                tStroke.Color = C.Accent
                tStroke.Transparency = 1
                tStroke.Thickness = 1
                
                b.Focused:Connect(function() 
                    Tween(tStroke, {0.2}, {Transparency = 0.6}) 
                end)
                b.FocusLost:Connect(function() 
                    Tween(tStroke, {0.2}, {Transparency = 1})
                    cb(b.Text) 
                end)
                return b
            end

            return e
        end
        return tab
    end

    function window:AddDrag(obj)
        -- ÂéüÊãñÊãΩ‰∏çËÆä
        local dragging, dragStart, startPos
        obj.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = true 
                dragStart = input.Position 
                startPos = obj.Position
            end
        end)
        services.UserInputService.InputChanged:Connect(function(input)
            if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
                local delta = input.Position - dragStart
                obj.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end)
        services.UserInputService.InputEnded:Connect(function() 
            dragging = false 
        end)
    end

    window:AddDrag(Main)
    return window, sg
end

return library
