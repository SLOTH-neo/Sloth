local Library = {}
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local Config = {
    WindowSize = UDim2.new(0, 500, 0, 350),
    CornerRadius = UDim.new(0, 12),
    Colors = {
        Main = Color3.fromRGB(15, 15, 20),
        Sidebar = Color3.fromRGB(20, 20, 25),
        Content = Color3.fromRGB(25, 25, 30),
        Accent = Color3.fromRGB(255, 60, 140),
        Accent2 = Color3.fromRGB(130, 60, 255),
        Text = Color3.fromRGB(240, 240, 240),
        TextDark = Color3.fromRGB(150, 150, 150),
        Stroke = Color3.fromRGB(255, 60, 140)
    }
}

local function Create(class, props)
    local instance = Instance.new(class)
    for k, v in pairs(props) do instance[k] = v end
    return instance
end

local function Tween(instance, properties, duration)
    TweenService:Create(instance, TweenInfo.new(duration or 0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), properties):Play()
end

local function Ripple(button)
    task.spawn(function()
        local ripple = Create("Frame", {
            Name = "Ripple",
            Parent = button,
            BackgroundColor3 = Color3.new(1, 1, 1),
            BackgroundTransparency = 0.8,
            BorderSizePixel = 0,
            AnchorPoint = Vector2.new(0.5, 0.5),
            Position = UDim2.new(0.5, 0, 0.5, 0),
            Size = UDim2.new(0, 0, 0, 0),
            ZIndex = 9
        })
        Create("UICorner", {Parent = ripple, CornerRadius = UDim.new(1, 0)})
        TweenService:Create(ripple, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = UDim2.new(0, button.AbsoluteSize.X * 1.5, 0, button.AbsoluteSize.X * 1.5), BackgroundTransparency = 1}):Play()
        task.wait(0.5)
        ripple:Destroy()
    end)
end

local function MakeDraggable(frame, handle)
    local dragging, dragInput, dragStart, startPos
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

function Library.new(title)
    if CoreGui:FindFirstChild("NEKO_UI_V3") then CoreGui.NEKO_UI_V3:Destroy() end
    local ScreenGui = Create("ScreenGui", {Name = "NEKO_UI_V3", Parent = CoreGui, ResetOnSpawn = false})
    
    local MinBtn = Create("TextButton", {
        Name = "MinBtn", Parent = ScreenGui, Size = UDim2.new(0, 45, 0, 45), Position = UDim2.new(0.1, 0, 0.1, 0),
        BackgroundColor3 = Config.Colors.Main, Text = "üê±", TextSize = 25, Visible = false, TextColor3 = Config.Colors.Accent
    })
    Create("UICorner", {Parent = MinBtn, CornerRadius = UDim.new(1, 0)})
    Create("UIStroke", {Parent = MinBtn, Color = Config.Colors.Accent, Thickness = 2})
    MakeDraggable(MinBtn, MinBtn)

    local Main = Create("Frame", {
        Name = "Main", Parent = ScreenGui, Size = Config.WindowSize, 
        Position = UDim2.new(0.5, -250, 0.5, -175), BackgroundColor3 = Config.Colors.Main
    })
    Create("UICorner", {Parent = Main, CornerRadius = Config.CornerRadius})
    local MainGlow = Create("UIStroke", {Parent = Main, Thickness = 2.5, Color = Config.Colors.Accent, Transparency = 0.4})
    local Grad = Create("UIGradient", {
        Parent = MainGlow, Rotation = 0,
        Color = ColorSequence.new{ColorSequenceKeypoint.new(0, Config.Colors.Accent), ColorSequenceKeypoint.new(0.5, Config.Colors.Accent2), ColorSequenceKeypoint.new(1, Config.Colors.Accent)}
    })
    task.spawn(function() while Main.Parent do Grad.Rotation = (Grad.Rotation + 1) % 360 task.wait(0.01) end end)
    MakeDraggable(Main, Main)

    local Sidebar = Create("Frame", {Parent = Main, Size = UDim2.new(0, 130, 1, 0), BackgroundColor3 = Config.Colors.Sidebar, BorderSizePixel = 0})
    Create("UICorner", {Parent = Sidebar, CornerRadius = Config.CornerRadius})
    Create("Frame", {Parent = Sidebar, Size = UDim2.new(0, 15, 1, 0), Position = UDim2.new(1, -15, 0, 0), BackgroundColor3 = Config.Colors.Sidebar, BorderSizePixel = 0})

    local Title = Create("TextLabel", {
        Parent = Sidebar, Size = UDim2.new(1, 0, 0, 50), Position = UDim2.new(0, 0, 0, 5),
        BackgroundTransparency = 1, Text = "üêæ " .. title:upper(), TextColor3 = Config.Colors.Accent, Font = Enum.Font.GothamBlack, TextSize = 16
    })

    local TabScroll = Create("ScrollingFrame", {
        Parent = Sidebar, Size = UDim2.new(1, 0, 1, -70), Position = UDim2.new(0, 0, 0, 60),
        BackgroundTransparency = 1, ScrollBarThickness = 0, CanvasSize = UDim2.new(0,0,0,0)
    })
    local TabList = Create("UIListLayout", {Parent = TabScroll, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 5)})

    local Pages = Create("Frame", {Parent = Main, Size = UDim2.new(1, -145, 1, -20), Position = UDim2.new(0, 135, 0, 10), BackgroundTransparency = 1})

    local Close = Create("TextButton", {
        Parent = Main, Size = UDim2.new(0, 30, 0, 30), Position = UDim2.new(1, -35, 0, 5),
        BackgroundTransparency = 1, Text = "√ó", TextColor3 = Config.Colors.TextDark, TextSize = 24, Font = Enum.Font.GothamBold
    })
    Close.MouseButton1Click:Connect(function() Main.Visible = false MinBtn.Visible = true end)
    MinBtn.MouseButton1Click:Connect(function() Main.Visible = true MinBtn.Visible = false end)

    local window = {current = nil}

    function window:Tab(name)
        local Page = Create("ScrollingFrame", {
            Parent = Pages, Size = UDim2.new(1, 0, 1, 0), BackgroundTransparency = 1,
            ScrollBarThickness = 2, ScrollBarImageColor3 = Config.Colors.Accent, Visible = false, CanvasSize = UDim2.new(0,0,0,0)
        })
        local PageList = Create("UIListLayout", {Parent = Page, SortOrder = Enum.SortOrder.LayoutOrder, Padding = UDim.new(0, 8)})
        PageList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function() Page.CanvasSize = UDim2.new(0, 0, 0, PageList.AbsoluteContentSize.Y + 10) end)

        local TabBtn = Create("TextButton", {
            Parent = TabScroll, Size = UDim2.new(1, -15, 0, 32), Position = UDim2.new(0, 7, 0, 0),
            BackgroundColor3 = Config.Colors.Content, BackgroundTransparency = 1, Text = name,
            TextColor3 = Config.Colors.TextDark, Font = Enum.Font.GothamMedium, TextSize = 13, AutoButtonColor = false
        })
        Create("UICorner", {Parent = TabBtn, CornerRadius = UDim.new(0, 6)})
        local Line = Create("Frame", {Parent = TabBtn, Size = UDim2.new(0, 2, 0, 14), Position = UDim2.new(0, 2, 0.5, -7), BackgroundColor3 = Config.Colors.Accent, BackgroundTransparency = 1})

        TabBtn.MouseButton1Click:Connect(function()
            if window.current then
                window.current.Page.Visible = false
                window.current.Btn.TextColor3 = Config.Colors.TextDark
                window.current.Btn.BackgroundTransparency = 1
                window.current.Line.BackgroundTransparency = 1
            end
            Page.Visible = true
            TabBtn.TextColor3 = Config.Colors.Text
            TabBtn.BackgroundTransparency = 0.9
            Line.BackgroundTransparency = 0
            window.current = {Page = Page, Btn = TabBtn, Line = Line}
        end)

        if not window.current then
            Page.Visible = true
            TabBtn.TextColor3 = Config.Colors.Text
            TabBtn.BackgroundTransparency = 0.9
            Line.BackgroundTransparency = 0
            window.current = {Page = Page, Btn = TabBtn, Line = Line}
        end

        local tab = {}
        function tab:Section(txt)
            local SFrame = Create("Frame", {Parent = Page, Size = UDim2.new(1, -10, 0, 25), BackgroundTransparency = 1})
            Create("TextLabel", {Parent = SFrame, Size = UDim2.new(1, 0, 1, 0), BackgroundTransparency = 1, Text = txt:upper(), TextColor3 = Config.Colors.Accent, Font = Enum.Font.GothamBold, TextSize = 11, TextXAlignment = Enum.TextXAlignment.Left})
            local e = {}
            function e:Button(t, cb)
                local b = Create("TextButton", {Parent = Page, Size = UDim2.new(1, -10, 0, 34), BackgroundColor3 = Config.Colors.Content, Text = t, TextColor3 = Config.Colors.Text, Font = Enum.Font.Gotham, TextSize = 13, AutoButtonColor = false})
                Create("UICorner", {Parent = b, CornerRadius = UDim.new(0, 6)})
                Create("UIStroke", {Parent = b, Color = Config.Colors.Stroke, Thickness = 0.6, Transparency = 0.6})
                b.MouseButton1Click:Connect(function() Ripple(b) cb() end)
            end
            function e:Toggle(t, s, cb)
                local enabled = s or false
                local b = Create("TextButton", {Parent = Page, Size = UDim2.new(1, -10, 0, 34), BackgroundColor3 = Config.Colors.Content, Text = "  " .. t, TextColor3 = Config.Colors.Text, Font = Enum.Font.Gotham, TextSize = 13, TextXAlignment = Enum.TextXAlignment.Left, AutoButtonColor = false})
                Create("UICorner", {Parent = b, CornerRadius = UDim.new(0, 6)})
                local sw = Create("Frame", {Parent = b, Size = UDim2.new(0, 32, 0, 16), Position = UDim2.new(1, -40, 0.5, -8), BackgroundColor3 = enabled and Config.Colors.Accent or Color3.fromRGB(50,50,55)})
                Create("UICorner", {Parent = sw, CornerRadius = UDim.new(1, 0)})
                local dot = Create("Frame", {Parent = sw, Size = UDim2.new(0, 12, 0, 12), Position = enabled and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6), BackgroundColor3 = Color3.new(1,1,1)})
                Create("UICorner", {Parent = dot, CornerRadius = UDim.new(1, 0)})
                b.MouseButton1Click:Connect(function()
                    enabled = not enabled
                    Tween(sw, {BackgroundColor3 = enabled and Config.Colors.Accent or Color3.fromRGB(50,50,55)}, 0.2)
                    Tween(dot, {Position = enabled and UDim2.new(1, -14, 0.5, -6) or UDim2.new(0, 2, 0.5, -6)}, 0.2)
                    cb(enabled)
                end)
            end
            function e:Textbox(p, d, cb)
                local b = Create("TextBox", {Parent = Page, Size = UDim2.new(1, -10, 0, 34), BackgroundColor3 = Config.Colors.Content, Text = d or "", PlaceholderText = p, TextColor3 = Config.Colors.Text, PlaceholderColor3 = Config.Colors.TextDark, Font = Enum.Font.Gotham, TextSize = 13})
                Create("UICorner", {Parent = b, CornerRadius = UDim.new(0, 6)})
                b.FocusLost:Connect(function() cb(b.Text) end)
            end
            return e
        end
        return tab
    end
    return window
end

return Library
