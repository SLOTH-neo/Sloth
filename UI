local library = {}

local services = setmetatable({}, {
    __index = function(_, k)
        return game:GetService(k)
    end
})

local TweenService = services.TweenService
local UserInputService = services.UserInputService

local Colors = {
    Accent   = Color3.fromRGB(255,120,180),
    BG       = Color3.fromRGB(18,18,22),
    Side     = Color3.fromRGB(14,14,18),
    Section  = Color3.fromRGB(28,28,34),
    Button   = Color3.fromRGB(40,40,48),
    Text     = Color3.fromRGB(235,235,240),
    SubText  = Color3.fromRGB(150,150,165),
    Stroke   = Color3.fromRGB(255,140,195)
}

local function tween(o,t,p)
    local tw = TweenService:Create(o,TweenInfo.new(unpack(t)),p)
    tw:Play()
end

function library.new(title)
    local gui = Instance.new("ScreenGui", services.CoreGui)
    gui.Name = "NekoUI"
    gui.ResetOnSpawn = false

    local main = Instance.new("Frame", gui)
    main.Size = UDim2.new(0,520,0,360)
    main.Position = UDim2.new(0.5,-260,0.5,-180)
    main.BackgroundColor3 = Colors.BG
    main.BorderSizePixel = 0
    Instance.new("UICorner", main).CornerRadius = UDim.new(0,16)

    local stroke = Instance.new("UIStroke", main)
    stroke.Color = Colors.Stroke
    stroke.Thickness = 1.5
    stroke.Transparency = 0.4

    local side = Instance.new("Frame", main)
    side.Size = UDim2.new(0,150,1,0)
    side.BackgroundColor3 = Colors.Side
    side.BorderSizePixel = 0
    Instance.new("UICorner", side).CornerRadius = UDim.new(0,16)

    local titleLabel = Instance.new("TextLabel", side)
    titleLabel.Size = UDim2.new(1,0,0,50)
    titleLabel.Text = title
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 18
    titleLabel.TextColor3 = Colors.Accent
    titleLabel.BackgroundTransparency = 1

    local tabs = Instance.new("UIListLayout", side)
    tabs.Padding = UDim.new(0,6)
    tabs.HorizontalAlignment = Enum.HorizontalAlignment.Center
    tabs.VerticalAlignment = Enum.VerticalAlignment.Top

    local pages = Instance.new("Frame", main)
    pages.Size = UDim2.new(1,-170,1,-20)
    pages.Position = UDim2.new(0,160,0,10)
    pages.BackgroundTransparency = 1

    local window = {}
    window.current = nil

    function window:Tab(name)
        local btn = Instance.new("TextButton", side)
        btn.Size = UDim2.new(1,-20,0,36)
        btn.Text = name
        btn.Font = Enum.Font.Gotham
        btn.TextSize = 14
        btn.TextColor3 = Colors.Text
        btn.BackgroundColor3 = Colors.Button
        btn.BorderSizePixel = 0
        Instance.new("UICorner", btn).CornerRadius = UDim.new(0,8)

        local page = Instance.new("ScrollingFrame", pages)
        page.Size = UDim2.new(1,0,1,0)
        page.CanvasSize = UDim2.new(0,0,0,0)
        page.ScrollBarThickness = 4
        page.Visible = false
        page.BackgroundTransparency = 1

        local layout = Instance.new("UIListLayout", page)
        layout.Padding = UDim.new(0,10)
        layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            page.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y + 10)
        end)

        btn.MouseButton1Click:Connect(function()
            if window.current then
                window.current.Visible = false
            end
            window.current = page
            page.Visible = true
        end)

        local tab = {}

        function tab:Section(text)
            local sec = Instance.new("Frame", page)
            sec.Size = UDim2.new(1,-10,0,40)
            sec.BackgroundColor3 = Colors.Section
            sec.BorderSizePixel = 0
            Instance.new("UICorner", sec).CornerRadius = UDim.new(0,10)

            local label = Instance.new("TextLabel", sec)
            label.Size = UDim2.new(1,-20,0,30)
            label.Position = UDim2.new(0,10,0,5)
            label.Text = text
            label.Font = Enum.Font.GothamSemibold
            label.TextSize = 14
            label.TextColor3 = Colors.Text
            label.BackgroundTransparency = 1
            label.TextXAlignment = Left

            local holder = Instance.new("UIListLayout", sec)
            holder.Padding = UDim.new(0,6)
            holder.VerticalAlignment = Enum.VerticalAlignment.Top

            holder:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                sec.Size = UDim2.new(1,-10,0,holder.AbsoluteContentSize.Y + 10)
            end)

            local section = {}

            function section:Button(text, cb)
                local b = Instance.new("TextButton", sec)
                b.Size = UDim2.new(1,-20,0,34)
                b.Text = text
                b.Font = Enum.Font.Gotham
                b.TextSize = 13
                b.TextColor3 = Colors.Text
                b.BackgroundColor3 = Colors.Button
                b.BorderSizePixel = 0
                Instance.new("UICorner", b).CornerRadius = UDim.new(0,8)
                b.MouseButton1Click:Connect(function()
                    if cb then cb() end
                end)
                return b
            end

            function section:Toggle(text, cb)
                local state = false
                local t = self:Button(text .. " : OFF", function()
                    state = not state
                    t.Text = text .. (state and " : ON" or " : OFF")
                    if cb then cb(state) end
                end)
                return t
            end

            return section
        end

        if not window.current then
            window.current = page
            page.Visible = true
        end

        return tab
    end

    function window:AddDrag(obj)
        local drag, start, startPos
        obj.InputBegan:Connect(function(i)
            if i.UserInputType == Enum.UserInputType.MouseButton1 then
                drag = true
                start = i.Position
                startPos = obj.Position
                i.Changed:Connect(function()
                    if i.UserInputState == Enum.UserInputState.End then
                        drag = false
                    end
                end)
            end
        end)
        UserInputService.InputChanged:Connect(function(i)
            if drag and i.UserInputType == Enum.UserInputType.MouseMovement then
                local delta = i.Position - start
                obj.Position = UDim2.new(
                    startPos.X.Scale,
                    startPos.X.Offset + delta.X,
                    startPos.Y.Scale,
                    startPos.Y.Offset + delta.Y
                )
            end
        end)
    end

    return window, gui
end

return library
